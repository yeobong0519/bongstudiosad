<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- âœ… Open Graph (ì¹´ì¹´ì˜¤í†¡/ë©”ì‹ ì € ë§í¬ ë¯¸ë¦¬ë³´ê¸° ê¸°ë³¸ ì´ë¯¸ì§€) -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://bongstudiosad.com/" />
  <meta property="og:title" content="ì—¬ë´‰ì´ ë”ì¿  ë ˆë²¨ í…ŒìŠ¤íŠ¸" />
  <meta property="og:description" content="ì—¬ë´‰ì´ ë”ì¿  ë ˆë²¨ í…ŒìŠ¤íŠ¸ - ê²°ê³¼ëŠ” ë”ì¿  ë ˆë²¨ë¡œ ë‚˜ì™€ìš”" />
  <meta property="og:image" content="https://bongstudiosad.com/img/og_default.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="ì—¬ë´‰ì´ ë”ì¿  ë ˆë²¨ í…ŒìŠ¤íŠ¸" />
  <meta name="twitter:description" content="ì—¬ë´‰ì´ ë”ì¿  ë ˆë²¨ í…ŒìŠ¤íŠ¸ - ê²°ê³¼ëŠ” ë”ì¿  ë ˆë²¨ë¡œ ë‚˜ì™€ìš”" />
  <meta name="twitter:image" content="https://bongstudiosad.com/img/og_default.png" />

<title>ì—¬ë´‰ì´ ë”ì¿  ë ˆë²¨ í…ŒìŠ¤íŠ¸</title>

  <!-- Google Adsense (ìœ ì§€) -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2371351351559028"
    crossorigin="anonymous"></script>

  <!-- âœ… Kakao AdFit Script (í•œ ë²ˆë§Œ ë¡œë“œ) -->
  <script async src="https://t1.daumcdn.net/kas/static/ba.min.js"></script>

  <!-- Kakao SDK -->
  <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js"
          crossorigin="anonymous"></script>
  <script>
    // âœ… ì¹´ì¹´ì˜¤ SDKê°€ ë¡œë“œ ì‹¤íŒ¨/ì°¨ë‹¨ë¼ë„ í˜ì´ì§€ ë²„íŠ¼ì´ ì•ˆ ì£½ê²Œ ë°©ì–´
    try {
      if (window.Kakao && !Kakao.isInitialized()) {
        Kakao.init("e9794a44d4c69a353097f55a960e6cab");
      }
      console.log("Kakao init:", window.Kakao ? Kakao.isInitialized() : "Kakao SDK not loaded");
    } catch (e) {
      console.warn("Kakao init error (safe):", e);
    }
  </script>

  <style>
    :root{
      --themeColor:#0f5a2a;    /* ê²°ê³¼ ë ˆë²¨ë³„ë¡œ JSì—ì„œ ë³€ê²½ */
      --themeTitleColor:#111;  /* (ìœ ì§€) */
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f6f6f6;
      color: #222;
    }

    .app {
      max-width: 420px;
      margin: 0 auto;
      padding: 18px 12px 40px;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }

    h1, h2 {
      margin: 8px 0;
      text-align: center;
    }

    .btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: bold;
      margin-top: 10px;
      cursor: pointer;
      background: #222;
      color: white;
    }

    .btn.secondary {
      background: #eee;
      color: #222;
    }

    .question-title {
      font-weight: 800;
      font-size: 16px;
      margin-bottom: 14px;
      line-height: 1.4;
    }

    .option-btn {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #ddd;
      background: #fff;
      font-size: 14px;
      margin-bottom: 10px;
      cursor: pointer;
      text-align: left;
      font-weight: 700;
    }

    .option-btn:hover {
      background: #f2f2f2;
    }

    .progress-wrap {
      margin: 10px 0 0;
    }
    .progress-text {
      font-size: 12px;
      color: #666;
      margin-bottom: 6px;
    }
    .progress {
      width: 100%;
      height: 10px;
      background: #eee;
      border-radius: 999px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background: #222;
      transition: width .25s ease;
    }

    /* âœ… ê³µìœ  íŒì—… */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    .hidden { display:none; }

    .popup-card {
      background: #fff;
      border-radius: 16px;
      padding: 16px;
      width: calc(100% - 40px);
      max-width: 340px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      text-align: center;
    }

    /* âœ… ê³µìœ  íŒì—… ë²„íŠ¼ ì‹œê·¸ë‹ˆì²˜ ì»¬ëŸ¬ */
    .btn.share-kakao {
      background-color: #FEE500 !important;
      color: #000000 !important;
    }
    .btn.share-x {
      background-color: #000000 !important;
      color: #FFFFFF !important;
    }

    /* âœ… ê²°ê³¼ í¬ìŠ¤í„° + í‘œ(ì„¤ëª…) ì „ìš© */
    .result-poster {
      background:#fff;
      border-radius:18px;
      overflow:hidden;
      margin:14px 0 16px;
      box-shadow:0 10px 24px rgba(0,0,0,0.08);
      border:1px solid rgba(0,0,0,0.05);
    }

    .poster-header {
      background: var(--themeColor);
      color:#fff; /* âœ… ìš”ì²­: ë°°ê²½ìƒ‰ ìœ„ í°ìƒ‰ ê¸€ì”¨ ìœ ì§€ */
      font-weight:900;
      font-size:20px;
      padding:14px 14px;
      text-align:left;
      letter-spacing:-0.2px;
    }

    .poster-image img {
      width:100%;
      height:auto;
      display:block;
      background:#fff;
    }

    /* âœ… ìš”ì²­: ì´ë¯¸ì§€ í•˜ë‹¨ í…ìŠ¤íŠ¸ ì œê±°(í•œ ì¤„ê³¼ ë‚´ìš© ë™ì¼) */
    .poster-quote { display:none !important; }

    .result-detail-card {
      text-align:left;
      margin-top:12px;
    }

    .result-table {
      width:100%;
      border-collapse:collapse;
      font-size:14px;
    }

    .result-table th {
      width:92px;
      text-align:left;
      vertical-align:top;
      padding:10px 8px;
      color:#555;
      font-weight:800;
      white-space:nowrap;
    }

    .result-table td {
      padding:10px 8px;
      line-height:1.5;
      color:#333;
    }

    .result-table tr:not(:last-child) {
      border-bottom:1px solid #eee;
    }

    .result-table .highlight {
      font-weight:900;
      color: var(--themeColor);
    }

    /* âœ… ìš”ì²­: í•œ ì¤„ í…ìŠ¤íŠ¸ ë‚´ìš© ë³¼ë“œ */
    #detail-oneline { font-weight:900; color:#111; }

    /* âœ… ìš”ì²­: ê²°ê³¼í˜ì´ì§€ ìµœìƒë‹¨ LV ê¸€ì”¨ìƒ‰ì€ ê²€ì •ìœ¼ë¡œ ì „ë¶€ í†µì¼ */
    #result-title { color:#000000 !important; }

    footer {
      text-align: center;
      font-size: 12px;
      color: #aaa;
      margin-top: 20px;
    }

    /* intro ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ */
    #intro-slider {
      width: 100%;
      border-radius: 14px;
      display: block;
      background: #eee;
      overflow: hidden;
    }
  </style>
</head>

<body>
<div class="app">

  <!-- HOME (ëª©ì°¨) -->
  <div id="page-home" class="page">
    <div class="card">
      <span class="tag">ì—¬ë´‰ì´ì˜ ë†€ì´í„°</span>
      <h1>ì—¬ë´‰ì´ì˜ í…ŒìŠ¤íŠ¸ ì—°êµ¬ì†Œ ğŸ§ª</h1>

      <h3 style="margin-top:16px;">ì˜¤ëŠ˜ì€ ì–´ë–¤ í…ŒìŠ¤íŠ¸ë¡œ ë†€ì•„ë³¼ê¹Œ?</h3>
      <button class="btn" onclick="showPage('intro')">ì—¬ë´‰ì´ ë”ì¿  ë ˆë²¨ í…ŒìŠ¤íŠ¸</button>
    </div>

    <div class="card">
      <!-- ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ ë°°ë„ˆ -->
      <div style="text-align:center;">
        <a href="https://link.coupang.com/a/deL5IN" target="_blank" referrerpolicy="unsafe-url">
          <img src="https://ads-partners.coupang.com/banners/950717?subId=&traceId=V0-301-bae0f72e5e59e45f-I950717&w=320&h=100"
               alt=""
               style="max-width:100%; height:auto;">
        </a>
      </div>
    </div>

    <footer>Â© YOBOONG TEST</footer>
  </div>

  <!-- INTRO (í‘œì§€) -->
  <div id="page-intro" class="page" style="display:none;">
    <div class="card">
      <img id="intro-slider" src="https://bongstudiosad.com/img/intro_1.png" alt="intro" />
      <h2 style="margin-top:12px;">ì—¬ë´‰ì´ ë”ì¿  ë ˆë²¨ í…ŒìŠ¤íŠ¸</h2>
      <p style="text-align:center;color:#666;margin:8px 0 0;">ê²°ê³¼ëŠ” ë”ì¿  ë ˆë²¨ë¡œ ë‚˜ì™€ìš”</p>

      <button class="btn" onclick="startQuiz()">ì‹œì‘í•˜ê¸°</button>
      <button class="btn secondary" onclick="showPage('home')">â† í…ŒìŠ¤íŠ¸ ëª©ë¡ìœ¼ë¡œ</button>
    </div>

    <footer>Â© YOBOONG TEST</footer>
  </div>

  <!-- QUIZ -->
  <div id="page-quiz" class="page" style="display:none;">
    <div class="card">
      <div class="progress-wrap">
        <div class="progress-text" id="progress-text">1 / 5</div>
        <div class="progress"><div class="progress-bar" id="progress-bar"></div></div>
      </div>

      <div class="question-title" id="question-text"></div>
      <div id="options-wrap"></div>
    </div>

    <footer>Â© YOBOONG TEST</footer>
  </div>

  <!-- LOADING -->
  <div id="page-loading" class="page" style="display:none;">
    <div class="card" style="text-align:center;">
      <h2>ë¶„ì„ ì¤‘...</h2>
      <p style="color:#666;">ì—¬ë´‰ì´ê°€ ë”ì¿  ë ˆë²¨ì„ ê³„ì‚°í•˜ê³  ìˆì–´!</p>
      <div style="margin-top:16px;">
        <div style="width:46px;height:46px;border:6px solid #eee;border-top-color:#222;border-radius:50%;margin:0 auto;animation:spin 1s linear infinite;"></div>
      </div>
    </div>

    <footer>Â© YOBOONG TEST</footer>
  </div>

  <!-- RESULT -->
  <div id="page-result" class="page" style="display:none;">
    <div class="card">
      <h2 id="result-title">LV1. í‚¹ë°˜ì¸</h2>

      <div class="result-poster">
        <div class="poster-header" id="poster-header">LV1. í‚¹ë°˜ì¸</div>
        <div class="poster-image">
          <img id="poster-image" src="https://bongstudiosad.com/img/result_kingbanin.png" alt="result">
        </div>
        <div class="poster-quote" id="poster-quote"></div>
      </div>

      <div class="result-detail-card">
        <table class="result-table">
          <tr>
            <th>í•œ ì¤„</th>
            <td id="detail-oneline"></td>
          </tr>
          <tr>
            <th>ìš”ì•½</th>
            <td id="detail-summary"></td>
          </tr>
          <tr>
            <th>ì„±í–¥</th>
            <td id="detail-traits"></td>
          </tr>
          <tr>
            <th>í–‰ë™</th>
            <td id="detail-actions"></td>
          </tr>
          <tr>
            <th>í•œë§ˆë””</th>
            <td id="detail-comment"></td>
          </tr>
        </table>
      </div>

      <button class="btn" style="margin-top:14px;" onclick="openSharePopup()">ê²°ê³¼ ê³µìœ í•˜ê¸°</button>
      <button class="btn secondary" onclick="restartQuiz()">ë‹¤ì‹œí•˜ê¸°</button>
      <button class="btn secondary" onclick="showPage('home')">â† í…ŒìŠ¤íŠ¸ ëª©ë¡ìœ¼ë¡œ</button>
    </div>

    <footer>Â© YOBOONG TEST</footer>
  </div>

</div>

<!-- ê³µìœ  íŒì—… -->
<div id="share-popup" class="overlay hidden">
  <div class="popup-card" style="max-width:320px;">
    <h2>ê²°ê³¼ ê³µìœ í•˜ê¸°</h2>
    <p style="font-size:14px;color:#666;">ì¹œêµ¬ë“¤ë„ ë”ì¿  ê³„ê¸‰ í•œ ë²ˆ ì¬ë³´ì!</p>

    <button class="btn share-kakao" onclick="shareKakao()">ì¹´ì¹´ì˜¤í†¡</button>

    <button class="btn" style="margin-top:10px;background:#ffb6c1;" onclick="shareInstagramStoryOptimal()">
      ì¸ìŠ¤íƒ€ ê³µìœ í•˜ê¸°
    </button>

    <button class="btn share-x" style="margin-top:10px;" onclick="shareXImageOptimal()">
      X ê³µìœ í•˜ê¸°
    </button>

    <button class="btn secondary" style="margin-top:10px;" onclick="copyTestLink()">
      ë§í¬ ë³µì‚¬í•˜ê¸°
    </button>

    <div id="share-status" style="margin-top:12px;font-size:12px;color:#777;min-height:18px;"></div>

    <button class="btn secondary" style="margin-top:12px;" onclick="closeSharePopup()">ë‹«ê¸°</button>
  </div>
</div>

<style>
@keyframes spin { to { transform: rotate(360deg); } }
</style>

<script>
  /* ========= ê³µí†µ ì„¤ì • ========= */
  const SITE_URL = "https://bongstudiosad.com";

  /* âœ… 2í˜ì´ì§€ í‘œì§€: intro_1~intro_5 ìë™ ë°˜ë³µ (GIF ëŠë‚Œ) */
  const INTRO_SLIDES = [
    `${SITE_URL}/img/intro_1.png`,
    `${SITE_URL}/img/intro_2.png`,
    `${SITE_URL}/img/intro_3.png`,
    `${SITE_URL}/img/intro_4.png`,
    `${SITE_URL}/img/intro_5.png`,
  ];
  let introSlideIdx = 0;
  let introTimer = null;

  function preloadIntroSlides() {
    INTRO_SLIDES.forEach(src => { const i = new Image(); i.src = src; });
  }

  function startIntroSlider() {
    const el = document.getElementById("intro-slider");
    if (!el) return;
    preloadIntroSlides();
    if (introTimer) clearInterval(introTimer);
    el.src = INTRO_SLIDES[introSlideIdx];
    introTimer = setInterval(() => {
      introSlideIdx = (introSlideIdx + 1) % INTRO_SLIDES.length;
      el.src = INTRO_SLIDES[introSlideIdx];
    }, 650);
  }

  function stopIntroSlider() {
    if (introTimer) clearInterval(introTimer);
    introTimer = null;
  }

  function showPage(key) {
    document.querySelectorAll(".page").forEach(p => (p.style.display = "none"));
    const el = document.getElementById("page-" + key);
    if (el) el.style.display = "block";

    if (key === "intro") startIntroSlider();
    else stopIntroSlider();

    window.scrollTo(0, 0);
  }

  /* âœ… ê²°ê³¼ ë ˆë²¨ë³„ í…Œë§ˆ(ìƒë‹¨ ë°°ê²½ìƒ‰) */
  const levelTheme = {
    kingbanin: { bg:"#000000", title:"#000000" },  // LV1 ê²€ì •
    pyeongmin: { bg:"#8B5A2B", title:"#8B5A2B" },  // LV2 ê°ˆìƒ‰
    knight:   { bg:"#808080", title:"#808080" },   // LV3 íšŒìƒ‰
    count:    { bg:"#0f5a2a", title:"#0f5a2a" },    // LV4 ì´ˆë¡
    kingof:   { bg:"#E53935", title:"#E53935" },    // LV5 ì ë¹¨ê°•
  };

  function applyLevelTheme() {
    const t = levelTheme[currentResultKey] || levelTheme.kingbanin;
    document.documentElement.style.setProperty("--themeColor", t.bg);
    document.documentElement.style.setProperty("--themeTitleColor", t.title);
  }

  const resultMeta = {
    kingbanin: { title:"LV1. í‚¹ë°˜ì¸", desc:"ì•„ì§ì€ í‚¹ë°˜ì¸... í•˜ì§€ë§Œ ì–¸ì œë“  ë”ì¿ ì˜ ê¸¸ë¡œ ì…ë¬¸ ê°€ëŠ¥!", imageUrl:`${SITE_URL}/img/result_kingbanin.png` },
    pyeongmin: { title:"LV2. í‰ë¯¼ ë”ì¿ ", desc:"í‹°ëŠ” ì•ˆ ë‚´ë„ ë•ì‹¬ì´ ì°¨ì˜¤ë¥´ëŠ” í‰ë¯¼ ë”ì¿ !", imageUrl:`${SITE_URL}/img/result_pyeongmin.png` },
    knight:   { title:"LV3. ê¸°ì‚¬ ë”ì¿ ", desc:"ìµœì• ë¥¼ ìœ„í•´ ë­ë“  í•  ìˆ˜ ìˆëŠ” ê¸°ì‚¬ ë”ì¿ !", imageUrl:`${SITE_URL}/img/result_knight.png` },
    count:    { title:"LV4. ê·€ì¡± ë”ì¿ ", desc:"êµ¿ì¦ˆ ì°½ê³ ê°€ ê±°ì˜ ì™•êµ­ê¸‰ì¸ ê·€ì¡± ë”ì¿ !", imageUrl:`${SITE_URL}/img/result_count.png` },
    kingof:   { title:"LV5. í‚¹ ì˜¤ë¸Œ ë”ì¿ ", desc:"ë”ì¿  ì¤‘ì˜ ë”ì¿ , í‚¹ ì˜¤ë¸Œ ë”ì¿ ! ì´ì¯¤ ë˜ë©´ ì¸ìƒì´ ì½˜í…ì¸ ë‹¤.", imageUrl:`${SITE_URL}/img/result_kingof.png` }
  };

  function getCurrentMeta() {
    return resultMeta[currentResultKey] || resultMeta.kingbanin;
  }

  function nl2br(s){ return (s || "").replace(/\n/g, "<br>"); }
  function listToLines(arr){ return (arr || []).map(x => `â€¢ ${x}`).join("<br>"); }

  /* âœ… ê²°ê³¼ ìƒì„¸ í…ìŠ¤íŠ¸ ë°ì´í„°(í–‰ë‹˜ ì›ë¬¸ ê¸°ë°˜) */
  const resultDetail = {
    kingbanin: {
      header: "LV1. í‚¹ë°˜ì¸",
      quote: "ì•„ë¬´ê²ƒë„ ëª¨ë¥´ì§€ë§Œ.. ì•„ë¬´ê²ƒë„ ëª¨ë¥´ì§€ ì•ŠëŠ”ë‹¤!",
      oneline: "â€œì•„ë¬´ê²ƒë„ ëª¨ë¥´ì§€ë§Œ.. ì•„ë¬´ê²ƒë„ ëª¨ë¥´ì§€ ì•ŠëŠ”ë‹¤!â€",
      summary:
        "ì¼ë°˜ì¸ê³¼ ë”ì¿ ì˜ ê²½ê³„ì„ , ì¼ë°˜ì¸ì´ë¼ ìƒê°í•˜ì§€ë§Œ,\nì•Œê³ ë¦¬ì¦˜ì˜ ì§€ë°°ë¥¼ ë°›ì•„ê°€ë©° ë¬´ì—‡ì´ë“  ë ìˆ˜ìˆëŠ” ë‹¨ê³„",
      traits: [
        "ë‚˜ ì´ì •ë„ê¹Œì§„ ëª°ë¼ ã…‹ã…‹",
        "ì–´ ? ì´ê±° ì‡¼ì¸ (ë¦´ìŠ¤)ë¡œ ë´¤ë˜ê±´ë°?",
        "ì´ ê°€ê²©ì˜ êµ¿ì¦ˆë¥¼ ì‚°ë‹¤ê³ ?!!",
      ],
      actions: [
        "ì¢‹ì•„í•˜ëŠ”ê±´ ìˆì§€ë§Œ ë”¥í•˜ê²Œ ë“¤ì–´ê°€ì§„ ì•ŠëŠ”í¸",
        "ë•ì§ˆí•˜ëŠ” ì‚¬ëŒì„ ë³´ë©´ ì‹ ê¸°í•˜ë©´ì„œë„ ì‹ ê¸°í•¨!",
        "ì•„ëŠ”ê²Œ ìˆìœ¼ë©´ ì‹ ë‚¨ â€œ ì˜¤!!! ë‚˜ ì´ê±° ë³¸ê±°ê°™ì•„!!!â€",
      ],
      comment: "ì–´ëŠìˆœê°„ â€œì•„!? ì´ê±¸ì™œ ì´ì œë´¤ì§€..? í•  ì˜ˆì •â€",
    },
    pyeongmin: {
      header: "LV2. í‰ë¯¼ ë”ì¿ ",
      quote: "ì¢‹ì•„í•˜ëŠ” ê±´ ë§ëŠ”ë°â€¦ ë§‰ ë•í›„ê¹Œì§„ ì•„ë‹ˆì•¼",
      oneline: "â€œì¢‹ì•„í•˜ëŠ” ê±´ ë§ëŠ”ë°â€¦ ë§‰ ë•í›„ê¹Œì§„ ì•„ë‹ˆì•¼â€",
      summary:
        "ë•ì§ˆ ë£¨í‹´ì´ ìƒê¸°ê¸° ì‹œì‘í•œ ë‹¨ê³„\nìŠ¬ìŠ¬ ë¶€ì •ì´ ì–´ë ¤ì›Œì§„ë‹¤",
      traits: [
        "êµ¿ì¦ˆ 1~2ê°œì¯¤ì€ ë‹¹ì—°íˆ ìˆìŒ",
        "ìµœì•  ê´€ë ¨ ì†Œì‹ì€ ì€ê·¼íˆ ë‹¤ ì±™ê¹€",
        "ì…ë•ì„ ì¸ì •í• ì§€ ê³ ë¯¼ ì¤‘",
      ],
      actions: [
        "ë•ì§ˆ ê³„ì • íŒ”ë¡œìš°ê°€ ëŠ˜ì–´ë‚¨",
        "í–‰ì‚¬/íŒì—… ì†Œì‹ ì €ì¥í•´ë‘ ",
        "ì£¼ë³€ì— ì˜ì—…ì„ ì‹œë„í•´ë³¸ ì  ìˆìŒ",
      ],
      comment: "ì´ì œ ê³§â€¦ ë”ì¿ ì˜ ê¸¸ë¡œ ë“¤ì–´ê°ˆ ì¤€ë¹„ ì™„ë£Œ",
    },
    knight: {
      header: "LV3. ê¸°ì‚¬ ë”ì¿ ",
      quote: "ìµœì• ë¥¼ ìœ„í•´ ë­ë“  í•  ìˆ˜ ìˆëŠ” ê¸°ì‚¬ ë”ì¿ !",
      oneline: "â€œìµœì• ë¥¼ ìœ„í•´ ë­ë“  í•  ìˆ˜ ìˆëŠ” ê¸°ì‚¬ ë”ì¿ !â€",
      summary:
        "ìµœì•  ë³´í˜¸/ì˜ì—…/í™ë³´ê¹Œì§€ ê°€ëŠ¥í•œ ì¶©ì„± ê¸°ì‚¬ ë‹¨ê³„",
      traits: [
        "ì…ë•ì˜ ì •ì„ ê°€ì´ë“œ íˆ¬ì–´",
        "ìƒˆë¡œìš´ í˜•ì‹ì˜ êµ¿ì¦ˆ, ì»¨í…ì¸ , ë°ˆì„ ìƒì„±í•˜ëŠ” ìœ„ëŒ€í•œ ì¡´ì¬",
        "ë„ˆ ë•ë¶„ì— ë°©ê¸ˆ ë‹¤ë¥¸ ë”ì¿ ê°€ íƒ„ìƒí–ˆì–´ !",
      ],
      actions: [
        "ìµœì•  ì†Œì‹ ì•Œë¦¼ ON",
        "ì¹œêµ¬ì—ê²Œ ìì—°ìŠ¤ëŸ½ê²Œ ì˜ì—…",
        "êµ¿ì¦ˆ/ì´ë²¤íŠ¸ ì •ë³´ ìˆ˜ì§‘ì´ ë¹ ë¦„",
      ],
      comment: "ì´ì¯¤ ë˜ë©´ ë•ì§ˆì´ ì•„ë‹ˆë¼ ì‚¬ëª…ì´ë‹¤",
    },
    count: {
      header: "LV4. ê·€ì¡± ë”ì¿ ",
      quote: "êµ¿ì¦ˆ ì°½ê³ ? ê·¸ê±° ê·¸ëƒ¥ ë‚´ ë°©ì¸ë°",
      oneline: "â€œêµ¿ì¦ˆ ì°½ê³ ? ê·¸ê±° ê·¸ëƒ¥ ë‚´ ë°©ì¸ë°â€",
      summary:
        "ì‹œê°„/ëˆ/ê³µê°„ì„ ë•ì§ˆì— íˆ¬ìí•˜ëŠ” ìƒìœ„ ê·€ì¡± ë‹¨ê³„",
      traits: [
        "í•œì •íŒ/ì½œë¼ë³´ì— ê°•í•¨",
        "ë•ì§ˆ ì˜ˆì‚°ì´ ë”°ë¡œ ì¡´ì¬",
        "êµ¿ì¦ˆ ì •ë¦¬/ë³´ê´€ë„ ì²´ê³„ì ",
      ],
      actions: [
        "ì˜ˆì•½/ì„ ì°©ìˆœì— ê°•í•¨",
        "ë•ì§ˆ ìŠ¤ì¼€ì¤„ ìº˜ë¦°ë”ê°€ ìˆìŒ",
        "êµ¿ì¦ˆ ë³´ê´€ ì¥ë¹„(?)ê°€ ëŠ˜ì–´ë‚¨",
      ],
      comment: "ê·€ì¡±ì€â€¦ ë•ì§ˆë„ í’ˆê²© ìˆê²Œ í•œë‹¤",
    },
    kingof: {
      header: "LV5. í‚¹ ì˜¤ë¸Œ ë”ì¿ ",
      quote: "ë”ì¿  ì¤‘ì˜ ë”ì¿ , í‚¹ ì˜¤ë¸Œ ë”ì¿ !",
      oneline: "â€œë”ì¿  ì¤‘ì˜ ë”ì¿ , í‚¹ ì˜¤ë¸Œ ë”ì¿ !â€",
      summary:
        "ë•ì§ˆ ì„¸ê³„ê´€ì„ ì´ë„ëŠ” ìµœìƒìœ„ ë‹¨ê³„\në•ì§ˆë¡œ ë¬¸í™”ë¥¼ ë§Œë“œëŠ” ì‚¬ëŒ",
      traits: [
        "ìƒˆ ì‘í’ˆ ë‚˜ì˜¤ë©´ ì œì¼ ë¨¼ì € ì•Œì•„ì±”",
        "êµ¿ì¦ˆ/ì´ë²¤íŠ¸/ë°ˆ ìƒì‚°ê¹Œì§€ ë¦¬ë“œ",
        "ë•ì§ˆë¡œ ì‚¬ëŒì„ ëª¨ìœ¼ëŠ” íƒ€ì…",
      ],
      actions: [
        "ë•ì§ˆ ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ì˜í–¥ë ¥ ìˆìŒ",
        "ì‹ ê·œ ë”ì¿ ë¥¼ ì–‘ì„±(?)í•¨",
        "ë•ì§ˆì„ ì½˜í…ì¸ ë¡œ í™•ì¥í•œë‹¤",
      ],
      comment: "ì´ì œëŠ”â€¦ ë‹¹ì‹  ìì²´ê°€ í•˜ë‚˜ì˜ ì¥ë¥´ë‹¤",
    }
  };

  /* ========= í€´ì¦ˆ ë°ì´í„° ========= */
  const otakuQuestions = [
    {
      text: "ìµœê·¼ 1ë…„ê°„ ë³¸ ì• ë‹ˆë©”ì´ì…˜ ê°œìˆ˜ëŠ”!?",
      options: [
        { label: "A. 0~3ê°œ / ê°€ë” ë„·í”Œì— í•«í•œ ê±° ìˆìœ¼ë©´ ë³´ëŠ”?", point: 0 },
        { label: "B. 4~12ê°œ / í•«í•œ ê±° ì™¸ì—ë„ ì¬ë°Œì–´ ë³´ì´ë©´ ì±™ê²¨ë³´ëŠ” í¸", point: 5 },
        { label: "C. 13ê°œ ì´ìƒ / ê·¼ë° ì´ê±¸ ëª‡ í¸ ë´¤ëŠ”ì§€ ì…€ ìˆ˜ê°€ ìˆë‚˜?", point: 10 },
      ],
    },
    {
      text: "ìµœì•  ìºë¦­í„°í•œí…Œ ëˆ ì–¼ë§ˆë‚˜ ì¼ì–´? (ëˆ„ì )",
      options: [
        { label: "A. 10ë§Œ ì› ì´í•˜ / ì§„ì§œ íƒë‚˜ëŠ” ê²Œ ìˆìœ¼ë©´ í•œ ë²ˆì¯¤..?", point: 0 },
        { label: "B. 11~50ë§Œ ì› / ì¼ë‹¨ ë§ˆìŒì— ë“œëŠ” ê²Œ ìˆìœ¼ë©´ ë‹¤ ì§ˆëŸ¬ë³´ì!", point: 5 },
        { label: "C. 51ë§Œ ì› ì´ìƒ / ë‚´ ì›”ê¸‰ì´ í…… ë¹ˆ íƒ“ì¼ê¹Œ..", point: 10 },
      ],
    },
    {
      text: "ì¹œêµ¬í•œí…Œ ì• ë‹ˆë©”ì´ì…˜ì„ ì¶”ì²œí•´ë³¸ ì  ìˆë‹¤?",
      options: [
        { label: "A. \"ì•¼! ì´ê±° ì•ˆ ë³´ë©´ ì§„ì§œ ì¸ìƒ ì—¬ì „ì´ë‹¤ ê¼­ ë´ë¼!!\"", point: 10 },
        { label: "B. \"ì´ê±° ì¡°ê¸ˆ ì¬ë°Œë‹¤ëŠ”ë°â€¦ í•œë²ˆ ë´ë³¼ë˜..?\" (ì€ê·¼ìŠ¬ì© ì¶”ì²œ)", point: 5 },
        { label: "C. í•œ ë²ˆë„ ì—†ëŠ”ë°..?", point: 0 },
      ],
    },
    {
      text: "ì¹œêµ¬ë“¤ì´ ë„ˆ ë³´ê³  â€œë„ˆ ì§„ì§œ ì˜¤íƒ€ì¿ ë‹¤â€ë¼ê³  í•˜ë©´ ê¸°ë¶„ì´?",
      options: [
        { label: "A. â€œë‹¹ì—°í•˜ì§€ ã…‹ã…‹â€ í•˜ë©´ì„œ ìë‘ìŠ¤ëŸ¬ì›Œí•¨", point: 10 },
        { label: "B. â€œë­â€¦ ì¢€ ì¢‹ì•„í•˜ê¸´ í•˜ì§€â€ í•˜ê³  ìŠ¬ì© ì¸ì •", point: 5 },
        { label: "C. â€œì•„ë‹ˆë¼ê³ !!â€ í•˜ë©´ì„œ ê°•í•˜ê²Œ ë¶€ì •í•¨", point: 0 },
      ],
    },
    {
      text: "ì½”ë¯¹ì›”ë“œì—ì„œ ì œì¼ ë¨¼ì € í•˜ëŠ” í–‰ë™ì€?",
      options: [
        { label: "A. ì¼ë‹¨ ë™ì„ ë¶€í„° ì§ ë‹¤(ê³„íší˜•)", point: 10 },
        { label: "B. ì¸ê¸° ë¶€ìŠ¤ ì¤„ë¶€í„° ì„ ë‹¤(ëˆˆì¹˜/ì†ë„)", point: 5 },
        { label: "C. ê·¸ëƒ¥ ëŒì•„ë‹¤ë‹ˆë‹¤ê°€ ëŒë¦¬ëŠ” ê³³ìœ¼ë¡œ ê°„ë‹¤(ê°ì„±)", point: 0 },
      ],
    },
  ];

  let currentIndex = 0;
  let totalScore = 0;
  let currentResultKey = "kingbanin";

  const qText = document.getElementById("question-text");
  const optionsWrap = document.getElementById("options-wrap");
  const progressText = document.getElementById("progress-text");
  const progressBar = document.getElementById("progress-bar");

  function startQuiz() {
    stopIntroSlider();
    currentIndex = 0;
    totalScore = 0;
    currentResultKey = "kingbanin";
    resetShareCache();
    renderQuestion();
    showPage("quiz");
  }

  function renderQuestion() {
    const q = otakuQuestions[currentIndex];
    qText.textContent = q.text;
    progressText.textContent = `${currentIndex + 1} / ${otakuQuestions.length}`;
    progressBar.style.width = `${((currentIndex + 1) / otakuQuestions.length) * 100}%`;

    optionsWrap.innerHTML = "";
    q.options.forEach(opt => {
      const btn = document.createElement("button");
      btn.className = "option-btn";
      btn.textContent = opt.label;
      btn.onclick = () => selectOption(opt.point);
      optionsWrap.appendChild(btn);
    });
  }

  function selectOption(point) {
    totalScore += point;
    if (currentIndex < otakuQuestions.length - 1) {
      currentIndex++;
      renderQuestion();
    } else {
      showPage("loading");
      setTimeout(() => {
        calculateResult();
        showPage("result");
      }, 3000);
    }
  }

  /* âœ… ê²°ê³¼ í¬ìŠ¤í„° ì´ë¯¸ì§€ ì„¸íŒ… */
  function setResultImage(url) {
    const img = document.getElementById("poster-image");
    if (!img) return;
    img.crossOrigin = "anonymous";
    img.src = url;
  }

  function renderResultDetail() {
    const meta = getCurrentMeta();
    const detail = resultDetail[currentResultKey] || resultDetail.kingbanin;

    // âœ… í…Œë§ˆ ì ìš©(ìƒë‹¨ ë°°ê²½ìƒ‰)
    applyLevelTheme();

    // í—¤ë”/íƒ€ì´í‹€
    document.getElementById("poster-header").textContent = detail.header;
    document.getElementById("result-title").textContent = meta.title;

    // âœ… ì´ë¯¸ì§€ í•˜ë‹¨ í…ìŠ¤íŠ¸(quote) ì œê±°: ìš”ì†ŒëŠ” ë‚¨ê¸°ë˜ ë‚´ìš© ë¹„ì›€(êµ¬ì„± ìœ ì§€)
    const pq = document.getElementById("poster-quote");
    if (pq) pq.textContent = "";

    // í¬ìŠ¤í„° ì´ë¯¸ì§€
    setResultImage(meta.imageUrl);

    // í‘œ í…ìŠ¤íŠ¸
    document.getElementById("detail-oneline").innerHTML = nl2br(detail.oneline);
    document.getElementById("detail-summary").innerHTML = nl2br(detail.summary);
    document.getElementById("detail-traits").innerHTML = listToLines(detail.traits);
    document.getElementById("detail-actions").innerHTML = listToLines(detail.actions);
    document.getElementById("detail-comment").innerHTML = nl2br(detail.comment);
  }

  function calculateResult() {
    if (totalScore <= 10) {
      currentResultKey = "kingbanin";
    } else if (totalScore <= 20) {
      currentResultKey = "pyeongmin";
    } else if (totalScore <= 30) {
      currentResultKey = "knight";
    } else if (totalScore <= 40) {
      currentResultKey = "count";
    } else {
      currentResultKey = "kingof";
    }

    renderResultDetail();
    resetShareCache();
  }

  function restartQuiz() {
    closeSharePopup();
    resetShareCache();
    startQuiz();
  }

  /* ========= ê³µìœ  íŒì—… ========= */
  function openSharePopup() {
    document.getElementById("share-popup").classList.remove("hidden");
    setShareStatus("ìŠ¤í† ë¦¬ ì´ë¯¸ì§€ ì¤€ë¹„ ì¤‘â€¦");
    prebuildStoryShareAsset()
      .then(() => setShareStatus("ê³µìœ  ì¤€ë¹„ ì™„ë£Œ!"))
      .catch(() => setShareStatus("ì´ë¯¸ì§€ ì¤€ë¹„ ì‹¤íŒ¨: ê²°ê³¼ ì´ë¯¸ì§€ ê²½ë¡œ/ë„ë©”ì¸ í™•ì¸ í•„ìš”"));
  }
  function closeSharePopup() {
    document.getElementById("share-popup").classList.add("hidden");
    setShareStatus("");
  }

  /* âœ… ë§í¬ ë³µì‚¬í•˜ê¸° */
  async function copyTestLink() {
    const link = "https://bongstudiosad.com/";
    const ok = await safeClipboardWrite(link);
    if (ok) {
      setShareStatus("âœ… ë§í¬ê°€ ë³µì‚¬ëì–´!");
      return;
    }

    try {
      const ta = document.createElement("textarea");
      ta.value = link;
      ta.style.position = "fixed";
      ta.style.left = "-9999px";
      ta.style.top = "0";
      document.body.appendChild(ta);
      ta.focus();
      ta.select();
      document.execCommand("copy");
      ta.remove();
      setShareStatus("âœ… ë§í¬ê°€ ë³µì‚¬ëì–´!");
    } catch (e) {
      setShareStatus("ë³µì‚¬ ì‹¤íŒ¨: ë¸Œë¼ìš°ì € ê¶Œí•œ í™•ì¸ í•„ìš”");
    }
  }

  /* ========= ì¹´ì¹´ì˜¤ ê³µìœ  ========= */
  function shareKakao() {
    if (!window.Kakao || !Kakao.isInitialized()) {
      alert("ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ì¤€ë¹„ ì¤‘ì´ì•¼. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì¤˜!");
      return;
    }

    const meta = getCurrentMeta();

    // âœ… ê²°ê³¼ë³„ OG ê³ ì • ë§í¬ (ì¹´í†¡ ì¹´ë“œì— ì´ë¯¸ì§€+ë§í¬ ê°™ì´ ë‚˜ì˜¤ê²Œ)
    const shareUrl = `${SITE_URL}/share/${currentResultKey}.html`;

    Kakao.Share.sendDefault({
      objectType: "feed",
      content: {
        title: `ì—¬ë´‰ì´ ë”ì¿  ë ˆë²¨ í…ŒìŠ¤íŠ¸ - ${meta.title}`,
        description: meta.desc,
        imageUrl: meta.imageUrl,
        link: { mobileWebUrl: shareUrl, webUrl: shareUrl }
      },
      buttons: [
        { title: "ë‚˜ë„ í…ŒìŠ¤íŠ¸í•˜ê¸°", link: { mobileWebUrl: shareUrl, webUrl: shareUrl } }
      ]
    });
  }

  /* ========= ì¸ìŠ¤íƒ€/ìŠ¤í† ë¦¬ ì´ë¯¸ì§€ ìƒì„± ========= */
  function loadImage(url) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = () => resolve(img);
      img.onerror = reject;
      img.src = url;
    });
  }

  function canvasToBlob(canvas, type = "image/png", quality) {
    return new Promise((resolve) => canvas.toBlob(resolve, type, quality));
  }

  function wrapText(ctx, text, centerX, startY, maxWidth, lineHeight) {
    const words = (text || "").split(" ");
    let line = "";
    let y = startY;

    ctx.textAlign = "center";
    for (let i = 0; i < words.length; i++) {
      const testLine = line + words[i] + " ";
      const metrics = ctx.measureText(testLine);
      if (metrics.width > maxWidth && i > 0) {
        ctx.fillText(line.trim(), centerX, y);
        line = words[i] + " ";
        y += lineHeight;
      } else {
        line = testLine;
      }
    }
    if (line.trim()) ctx.fillText(line.trim(), centerX, y);
  }

  function roundRect(ctx, x, y, width, height, radius) {
    const r = Math.min(radius, width / 2, height / 2);
    ctx.beginPath();
    ctx.moveTo(x + r, y);
    ctx.arcTo(x + width, y, x + width, y + height, r);
    ctx.arcTo(x + width, y + height, x, y + height, r);
    ctx.arcTo(x, y + height, x, y, r);
    ctx.arcTo(x, y, x + width, y, r);
    ctx.closePath();
  }

  async function buildStoryImageBlob() {
    const meta = getCurrentMeta();

    const W = 1080;
    const H = 1920;
    const canvas = document.createElement("canvas");
    canvas.width = W;
    canvas.height = H;

    const ctx = canvas.getContext("2d");

    const grad = ctx.createLinearGradient(0, 0, W, H);
    grad.addColorStop(0, "#ffeef2");
    grad.addColorStop(1, "#ffffff");
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, W, H);

    ctx.fillStyle = "#ff4d6d";
    ctx.font = "bold 56px system-ui, -apple-system, Segoe UI, sans-serif";
    ctx.textAlign = "center";
    ctx.fillText("ì—¬ë´‰ì´ ë”ì¿  ë ˆë²¨ í…ŒìŠ¤íŠ¸", W / 2, 160);

    ctx.fillStyle = "#222";
    ctx.font = "bold 78px system-ui, -apple-system, Segoe UI, sans-serif";
    ctx.fillText(meta.title, W / 2, 290);

    ctx.fillStyle = "#555";
    ctx.font = "36px system-ui, -apple-system, Segoe UI, sans-serif";
    wrapText(ctx, meta.desc, W / 2, 360, 880, 46);

    try {
      const img = await loadImage(meta.imageUrl);
      const maxW = 860;
      const maxH = 860;
      const scale = Math.min(maxW / img.width, maxH / img.height);
      const dw = img.width * scale;
      const dh = img.height * scale;

      const cardX = (W - 920) / 2;
      const cardY = 480;
      roundRect(ctx, cardX, cardY, 920, 960, 48);
      ctx.fillStyle = "rgba(255,255,255,0.92)";
      ctx.fill();
      ctx.strokeStyle = "rgba(255, 156, 174, 0.9)";
      ctx.lineWidth = 6;
      ctx.stroke();

      ctx.drawImage(img, (W - dw) / 2, cardY + 60, dw, dh);
    } catch (e) {
      ctx.fillStyle = "#888";
      ctx.font = "bold 40px system-ui, -apple-system, Segoe UI, sans-serif";
      ctx.fillText("ê²°ê³¼ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨", W / 2, 980);
    }

    ctx.fillStyle = "#ff6b81";
    ctx.font = "bold 40px system-ui, -apple-system, Segoe UI, sans-serif";
    ctx.fillText("ğŸ‘‰ ë‚˜ë„ í…ŒìŠ¤íŠ¸ í•˜ëŸ¬ê°€ê¸°", W / 2, 1780);

    ctx.fillStyle = "#333";
    ctx.font = "36px system-ui, -apple-system, Segoe UI, sans-serif";
    ctx.fillText(SITE_URL, W / 2, 1840);

    return await canvasToBlob(canvas, "image/png");
  }

  const SHARE = {
    storyFileCache: null,
    storyBlobCache: null,
    buildPromise: null,
    busy: false
  };

  function setShareStatus(msg) {
    const el = document.getElementById("share-status");
    if (!el) return;
    el.textContent = msg || "";
  }

  function setShareBusy(on) {
    SHARE.busy = on;
    const popup = document.getElementById("share-popup");
    if (!popup) return;
    popup.querySelectorAll("button").forEach(btn => {
      if (btn.textContent.includes("ë‹«ê¸°")) return;
      btn.disabled = !!on;
      btn.style.opacity = on ? "0.75" : "1";
      btn.style.cursor = on ? "not-allowed" : "pointer";
    });
  }

  async function safeClipboardWrite(text) {
    try {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(text);
        return true;
      }
    } catch (e) {}
    return false;
  }

  function resetShareCache() {
    SHARE.storyFileCache = null;
    SHARE.storyBlobCache = null;
    SHARE.buildPromise = null;
    SHARE.busy = false;
    setShareStatus("");
  }

  async function prebuildStoryShareAsset() {
    if (SHARE.storyFileCache && SHARE.storyBlobCache) return { file: SHARE.storyFileCache, blob: SHARE.storyBlobCache };
    if (SHARE.buildPromise) return SHARE.buildPromise;

    SHARE.buildPromise = (async () => {
      const blob = await buildStoryImageBlob();
      const file = new File([blob], "yoboong_result_story.png", { type: "image/png" });
      SHARE.storyBlobCache = blob;
      SHARE.storyFileCache = file;
      return { file, blob };
    })();

    try {
      return await SHARE.buildPromise;
    } finally {
      SHARE.buildPromise = null;
    }
  }

  function canWebShareFiles(file) {
    try {
      return !!(navigator.share && navigator.canShare && navigator.canShare({ files: [file] }));
    } catch (e) {
      return false;
    }
  }

  function downloadBlob(blob, filename) {
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  async function shareInstagramStoryOptimal() {
    if (SHARE.busy) return;
    setShareBusy(true);
    setShareStatus("ì¸ìŠ¤íƒ€ ê³µìœ  ì¤€ë¹„ ì¤‘â€¦");

    const meta = getCurrentMeta();
    await safeClipboardWrite(SITE_URL);

    try {
      const { file, blob } = await prebuildStoryShareAsset();

      if (canWebShareFiles(file)) {
        setShareStatus("ê³µìœ  ì‹œíŠ¸ ì—¬ëŠ” ì¤‘â€¦ (ì¸ìŠ¤íƒ€ê·¸ë¨ ì„ íƒ)");
        await navigator.share({
          files: [file],
          title: `ì—¬ë´‰ì´ í…ŒìŠ¤íŠ¸ - ${meta.title}`,
          text: `${meta.title} ê²°ê³¼!\n${SITE_URL}`,
          url: SITE_URL
        });
        setShareStatus("ê³µìœ  ì™„ë£Œ!");
        return;
      }

      setShareStatus("ê³µìœ ì‹œíŠ¸ ë¯¸ì§€ì›: ì´ë¯¸ì§€ ì €ì¥ í›„ ì¸ìŠ¤íƒ€ ìŠ¤í† ë¦¬ ì—´ê¸°");
      downloadBlob(blob, "yoboong_result_story.png");
      setTimeout(() => {
        window.location.href = "instagram://story-camera";
      }, 350);
      setShareStatus("ì´ë¯¸ì§€ ì €ì¥ í›„ ì¸ìŠ¤íƒ€ ìŠ¤í† ë¦¬ì— ì¶”ê°€í•´ì¤˜. (ë§í¬ëŠ” í´ë¦½ë³´ë“œ)");
    } catch (e) {
      console.error(e);
      setShareStatus("ì¸ìŠ¤íƒ€ ê³µìœ  ì‹¤íŒ¨: ê²°ê³¼ ì´ë¯¸ì§€ ê²½ë¡œ/ë„ë©”ì¸(CORS) í™•ì¸ í•„ìš”");
    } finally {
      setShareBusy(false);
    }
  }

  async function shareXImageOptimal() {
    if (SHARE.busy) return;
    setShareBusy(true);
    setShareStatus("X ì´ë¯¸ì§€ ê³µìœ  ì¤€ë¹„ ì¤‘â€¦");

    const meta = getCurrentMeta();

    try {
      const { file } = await prebuildStoryShareAsset();

      if (canWebShareFiles(file)) {
        setShareStatus("ê³µìœ  ì‹œíŠ¸ ì—¬ëŠ” ì¤‘â€¦ (X ì„ íƒ)");
        await navigator.share({
          files: [file],
          title: `ì—¬ë´‰ì´ í…ŒìŠ¤íŠ¸ - ${meta.title}`,
          text: `ë‚´ ê²°ê³¼ëŠ” ${meta.title} ğŸ¤­\n${SITE_URL}`,
          url: SITE_URL
        });
        setShareStatus("ê³µìœ  ì™„ë£Œ!");
        return;
      }

      const text = encodeURIComponent(`ë‚´ ê²°ê³¼ëŠ” ${meta.title} ğŸ¤­\në„ˆë„ í•´ë´ ğŸ‘‰`);
      const url = encodeURIComponent(SITE_URL);
      const intent = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
      window.open(intent, "_blank", "noopener,noreferrer");
      setShareStatus("í…ìŠ¤íŠ¸+ë§í¬ë¡œ ê³µìœ ì°½ ì—´ì—ˆì–´!");
    } catch (e) {
      console.error(e);
      setShareStatus("X ê³µìœ  ì‹¤íŒ¨: ë¸Œë¼ìš°ì €/ê¸°ê¸° ê³µìœ  ê¸°ëŠ¥ í™•ì¸ í•„ìš”");
    } finally {
      setShareBusy(false);
    }
  }

  /* âœ… ê³µìœ  ë§í¬ë¡œ ë“¤ì–´ì˜¨ ê²½ìš°: ê²°ê³¼ í‚¤ë¡œ ë°”ë¡œ ê²°ê³¼ í˜ì´ì§€ ì—´ê¸° */
  (function bootFromShareLink(){
    const params = new URLSearchParams(window.location.search);
    const r = params.get("r"); // kingbanin / pyeongmin / knight / count / kingof
    if (r && resultMeta[r]) {
      currentResultKey = r;
      renderResultDetail();
      resetShareCache();
      showPage("result");
      return;
    }
    /* ì‹œì‘ì€ í™ˆ */
    showPage("home");
    // í™ˆ/í‘œì§€ì—ì„œ intro ìŠ¬ë¼ì´ë”ê°€ í•„ìš”í•œ êµ¬ì„±ì´ë¼ë©´ ì¼œê¸°
    try { startIntroSlider(); } catch(e) {}
  })();
</script>
</body>
</html>
