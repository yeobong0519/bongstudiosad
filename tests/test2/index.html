<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ëª¬ìŠ¤í„° ì„¸ìƒ ì† ë‚˜ëŠ”?</title>

  <!-- âœ… OG(í…ŒìŠ¤íŠ¸2 ë§í¬ìš©) -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="ì—¬ë´‰ì´ ì„±í–¥í…ŒìŠ¤íŠ¸" />
  <meta property="og:title" content="ëª¬ìŠ¤í„° ì„¸ìƒ ì† ë‚˜ëŠ”?" />
  <meta property="og:description" content="ì—¬ê¸°ë¥¼ ëˆŒëŸ¬ í…ŒìŠ¤íŠ¸ í•˜ëŸ¬ ê°€ê¸°!" />
  <meta property="og:url" content="https://bongstudiosad.com/tests/test2/" />
  <meta property="og:image" content="https://bongstudiosad.com/img/og_default.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="ëª¬ìŠ¤í„° ì„¸ìƒ ì† ë‚˜ëŠ”?" />
  <meta name="twitter:description" content="ì—¬ê¸°ë¥¼ ëˆŒëŸ¬ í…ŒìŠ¤íŠ¸ í•˜ëŸ¬ ê°€ê¸°!" />
  <meta name="twitter:image" content="https://bongstudiosad.com/img/og_default.png" />

  <!-- Google Adsense (ìœ ì§€) -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2371351351559028"
    crossorigin="anonymous"></script>

  <!-- Kakao SDK -->
  <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js"
          crossorigin="anonymous"></script>
  <script>
    try {
      if (window.Kakao && !Kakao.isInitialized()) {
        Kakao.init("e9794a44d4c69a353097f55a960e6cab");
      }
      console.log("Kakao init:", window.Kakao ? Kakao.isInitialized() : "Kakao SDK not loaded");
    } catch (e) {
      console.warn("Kakao init error (safe):", e);
    }
  </script>

  <link rel="stylesheet" href="/common/common.css?v=2">

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f7;
      color: #222;
    }
    .app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      padding: 20px 16px 40px;
      box-sizing: border-box;
    }
    .card {
      background: #fff;
      border-radius: 18px;
      padding: 20px 18px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.05);
      margin-bottom: 18px;
    }

    h1 { font-size: 24px; margin: 0 0 8px; }
    h2 { font-size: 20px; margin: 12px 0 8px; }
    h3 { font-size: 16px; margin: 8px 0 4px; }
    p  { margin: 4px 0; line-height: 1.45; color:#555; }

    .tag {
      display:inline-block;
      background:#efe7ff;
      padding:4px 10px;
      border-radius:999px;
      font-size:12px;
      color:#5a2dce;
      margin-bottom:6px;
      font-weight:800;
    }

    .btn {
      width: 100%;
      padding: 14px 16px;
      border: none;
      border-radius: 999px;
      font-size: 15px;
      font-weight: 600;
      margin-top: 12px;
      cursor: pointer;
      background: #6d4aff;
      color: #fff;
    }
    .btn.secondary {
      background: #eceef3;
      color:#333;
    }
    .btn:active { transform: scale(0.98); }

    .option-btn {
      width: 100%;
      text-align: left;
      border-radius: 14px;
      border: 1px solid #ddd;
      padding: 12px 12px;
      margin-top: 10px;
      background: #fff;
      font-size: 14px;
      cursor: pointer;
    }
    .option-btn:hover {
      background: #f3efff;
      border-color: #6d4aff;
    }

    .progress-bar-bg {
      width:100%;
      height:7px;
      background:#ddd;
      border-radius:999px;
      overflow:hidden;
      margin-top:6px;
    }
    .progress-bar-fill {
      height:100%;
      width:0%;
      background:linear-gradient(90deg,#6d4aff,#b15cff);
      transition:0.3s;
    }

    .spinner {
      width:60px;
      height:60px;
      border-radius:50%;
      border:6px solid #e4dcff;
      border-top-color:#6d4aff;
      animation: spin 1s linear infinite;
      margin:20px auto 0;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .overlay {
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.55);
      display:flex;              /* âœ… íŒì—… ì¤‘ì•™ì •ë ¬ ì •ìƒí™” */
      justify-content:center;
      align-items:center;
      z-index:999;
    }
    .popup-card {
      width:85%;
      max-width:380px;
      background:#fff;
      border-radius:18px;
      padding:22px;
      text-align:center;
      margin:0 auto;
    }

    .hidden { display:none !important; }

    .ably-banner {
      display:block;
      margin-top:14px;
      padding:16px 14px;
      border-radius:14px;
      background: linear-gradient(135deg, #f3efff, #ffffff);
      border: 1px solid #d9ccff;
      text-decoration:none;
      overflow:hidden;
      position:relative;
    }
    .ably-banner .title {
      font-weight:900;
      color:#6d4aff;
      font-size:16px;
      letter-spacing:-0.2px;
    }
    .ably-banner .desc {
      margin-top:6px;
      color:#666;
      font-size:13px;
      line-height:1.3;
    }
    .ably-badge {
      position:absolute;
      right:12px;
      top:12px;
      background:#6d4aff;
      color:#fff;
      font-size:11px;
      font-weight:800;
      padding:6px 10px;
      border-radius:999px;
    }

    .insta-link {
      display:block;
      margin-top:12px;
      text-align:center;
      padding:12px;
      background:#f3efff;
      color:#6d4aff;
      font-weight:800;
      border-radius:12px;
      text-decoration:none;
    }

    .btn.share-kakao {
      background-color: #FEE500 !important;
      color: #000000 !important;
    }
    .btn.share-x {
      background-color: #000000 !important;
      color: #FFFFFF !important;
    }

    :root{
      --themeColor:#2c1b54;
    }

    .result-poster {
      background:#fff;
      border-radius:18px;
      overflow:hidden;
      margin:14px 0 16px;
      box-shadow:0 10px 24px rgba(0,0,0,0.08);
      border:1px solid rgba(0,0,0,0.05);
    }

    .poster-header { display:none !important; }
    .poster-quote { display:none !important; }

    .poster-image img {
      width:100%;
      height:auto;
      display:block;
      background:#fff;
    }

    .result-detail-card {
      text-align:left;
      margin-top:12px;
    }

    .result-table {
      width:100%;
      border-collapse:collapse;
      font-size:14px;
    }

    .result-table th {
      width:92px;
      text-align:left;
      vertical-align:top;
      padding:10px 8px;
      color:#555;
      font-weight:900;
      white-space:nowrap;
    }

    .result-table td {
      padding:10px 8px;
      line-height:1.5;
      color:#333;
    }

    .result-table tr:not(:last-child) {
      border-bottom:1px solid #eee;
    }

    .result-table .highlight {
      font-weight:900;
      color: var(--themeColor);
    }

    #detail-oneline { font-weight:900; color:#111; }
    #result-title { color:#000000 !important; }

    .cover-video {
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 16px;
      display: block;
      object-fit: cover;
      background: #100a24;
    }

    .compat-wrap {
      margin-top: 12px;
      border-top: 1px solid #eee;
      padding-top: 12px;
    }
    .compat-head {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      align-items:center;
      margin-bottom:10px;
    }
    .compat-head div{
      font-weight:900;
      color:#555;
      font-size:13px;
    }
    .compat-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .compat-item{
      border:1px solid rgba(0,0,0,0.08);
      border-radius:14px;
      padding:10px;
      background:#fff;
      text-align:center;
    }
    .compat-thumb{
      width:96px;
      height:96px;
      border-radius:14px;
      object-fit:cover;
      display:block;
      margin:0 auto;
      background:#f5f5f7;
    }
    .compat-name{
      margin-top:8px;
      font-size:12px;
      font-weight:900;
      color:#333;
      letter-spacing:-0.2px;
    }
    .compat-sub{
      margin-top:2px;
      font-size:11px;
      color:#777;
    }
  </style>
</head>

<body>

  <div id="nav-mount"></div>

  <div class="app">

    <!-- INTRO (í‘œì§€) -->
    <div id="page-intro" class="page hidden">
      <div class="card" style="text-align:center;">
        <span class="tag">ëª¬ìŠ¤í„° ì„¸ìƒ ì† ë‚˜ëŠ”?</span>
        <h1>ëª¬ìŠ¤í„° ì„¸ìƒ ì† ë‚˜ëŠ”?</h1>
        <p>ì–´ëŠ ë‚  ëª¬ìŠ¤í„°ë¡œ ë³€í•œ ì—¬ë´‰ì´, ë‚˜ëŠ” ì–´ë–¤ ëª¬ìŠ¤í„°ë¡œ ë³€í–ˆì„ê¹Œ?</p>

        <div style="margin:16px 0;">
          <video
            id="intro-video"
            class="cover-video"
            src="/media/cover_ghost.mp4"
            autoplay
            muted
            loop
            playsinline
            preload="metadata"
          ></video>
        </div>

        <p style="font-size:13px;color:#666;">
          ì´ 6ë¬¸í•­ Â· 1ë¶„ ì»· Â· ê²°ê³¼ëŠ” 9ì¢… ëª¬ìŠ¤í„° íƒ€ì…!
        </p>

        <button class="btn" onclick="startQuiz()">í…ŒìŠ¤íŠ¸ ì‹œì‘í•˜ê¸°</button>
      </div>

      <button class="btn secondary" onclick="location.href='/'">â† ë©”ì¸ìœ¼ë¡œ</button>
    </div>

    <!-- QUIZ -->
    <div id="page-quiz" class="page hidden">
      <div class="card">
        <span class="tag">ëª¬ìŠ¤í„° ì„¸ìƒ ì† ë‚˜ëŠ”?</span>
        <h3 id="progress-text">1 / 6</h3>
        <div class="progress-bar-bg">
          <div id="progress-bar" class="progress-bar-fill"></div>
        </div>

        <h2 id="question-text" style="margin-top:16px;">ì§ˆë¬¸</h2>
        <div id="options-wrap"></div>
      </div>
      <button class="btn secondary" onclick="location.href='/'">â† ë©”ì¸ìœ¼ë¡œ</button>
    </div>

    <!-- LOADING -->
    <div id="page-loading" class="page hidden">
      <div class="card" style="text-align:center;">
        <h2>ğŸ§ª ëª¬ìŠ¤í„° íƒ€ì… ë¶„ì„ ì¤‘â€¦</h2>
        <p>ëª¬ìŠ¤í„° ì‚¬íšŒ ë°ì´í„°ì— ëŒ€ì¡°ì¤‘ì´ì•¼</p>
        <div class="spinner"></div>
        <p style="font-size:12px;color:#777;margin-top:8px;">ì•½ 3ì´ˆ ì •ë„ ê±¸ë¦½ë‹ˆë‹¤.</p>
      </div>
    </div>

    <!-- RESULT -->
    <div id="page-result" class="page hidden">
      <div class="card" style="text-align:center;">
        <span class="tag">ëª¬ìŠ¤í„° íƒ€ì… ê²°ê³¼</span>
        <h1 id="result-title">ë§ˆë…€ë´‰</h1>

        <!-- âœ… Kakao AdFit: ê²°ê³¼ ì§„ì… ì‹œ JSë¡œ ìŠ¬ë¡¯ ìƒì„± -->
        <div id="adfit-slot" style="margin:14px 0; display:flex; justify-content:center;"></div>

        <div class="result-poster">
          <div id="poster-header" class="poster-header">ë§ˆë…€ë´‰</div>
          <div class="poster-image">
            <img id="poster-image" alt="ê²°ê³¼ í¬ìŠ¤í„° ì´ë¯¸ì§€">
          </div>
          <div id="poster-quote" class="poster-quote"></div>
        </div>

        <div class="result-detail-card">
          <table class="result-table">
            <tr><th>í•œ ì¤„</th><td id="detail-oneline"></td></tr>
            <tr><th>ìš”ì•½</th><td id="detail-summary"></td></tr>
            <tr><th>ì„±í–¥</th><td id="detail-traits"></td></tr>
            <tr><th>í–‰ë™</th><td id="detail-actions"></td></tr>
            <tr><th>ì½”ë©˜íŠ¸</th><td id="detail-comment" class="highlight"></td></tr>
          </table>

          <div class="compat-wrap">
            <div class="compat-head">
              <div>ì˜ë§ëŠ” íƒ€ì…</div>
              <div>ì•ˆë§ëŠ” íƒ€ì…</div>
            </div>

            <div class="compat-grid">
              <div class="compat-item">
                <img id="match-img" class="compat-thumb" alt="ì˜ë§ëŠ” íƒ€ì… ì´ë¯¸ì§€">
                <div id="match-name" class="compat-name"></div>
                <div class="compat-sub">ê¶í•© ìµœê³ </div>
              </div>

              <div class="compat-item">
                <img id="mismatch-img" class="compat-thumb" alt="ì•ˆë§ëŠ” íƒ€ì… ì´ë¯¸ì§€">
                <div id="mismatch-name" class="compat-name"></div>
                <div class="compat-sub">ìƒê·¹ ì£¼ì˜</div>
              </div>
            </div>
          </div>
        </div>

        <a class="ably-banner" href="https://applink.a-bly.com/bongstudios" target="_blank">
          <span class="ably-badge">SHOP</span>
          <div class="title">ì—¬ë´‰ì´ êµ¿ì¦ˆìƒµ ë°”ë¡œê°€ê¸°</div>
          <div class="desc">ê²°ê³¼ ë³´ê³  ë§ˆìŒì— ë“œëŠ” êµ¿ì¦ˆ ë°”ë¡œ ë‹´ìœ¼ëŸ¬ ê°€ê¸° â†’</div>
        </a>

        <a class="insta-link"
          href="https://www.instagram.com/bong_studios?igsh=d3c5bWl1aXNpc2Zt"
          target="_blank">
          ì—¬ë´‰ì´ ì¸ìŠ¤íƒ€ê·¸ë¨ ë°”ë¡œê°€ê¸°
        </a>

        <div style="display:flex; gap:10px; margin-top:18px;">
          <button class="btn" style="flex:1;" onclick="openSharePopup()">ê³µìœ í•˜ê¸°</button>
          <button class="btn secondary" style="flex:1;" onclick="restartQuiz()">ë‹¤ì‹œí•˜ê¸°</button>
        </div>

        <div style="margin-top:14px; display:flex; justify-content:center;">
          <a href="https://link.coupang.com/a/deL5IN" target="_blank" referrerpolicy="unsafe-url">
            <img src="https://ads-partners.coupang.com/banners/950717?subId=&traceId=V0-301-bae0f72e5e59e45f-I950717&w=320&h=100"
                alt=""
                style="max-width:100%; height:auto;">
          </a>
        </div>

      </div>
      <button class="btn secondary" onclick="location.href='/'">â† ë©”ì¸ìœ¼ë¡œ</button>
    </div>

    <div id="footer-mount"></div>
  </div>

  <!-- ê³µìœ  íŒì—… -->
  <div id="share-popup" class="overlay hidden">
    <div class="popup-card" style="max-width:320px;">
      <h2>ê²°ê³¼ ê³µìœ í•˜ê¸°</h2>
      <p style="font-size:14px;color:#666;">ì¹œêµ¬ë“¤ë„ ëª¬ìŠ¤í„° íƒ€ì… í•œ ë²ˆ ì¬ë³´ì!</p>

      <button class="btn share-kakao" onclick="shareKakao()">ì¹´ì¹´ì˜¤í†¡</button>
      <button class="btn" style="margin-top:10px;background:#bca8ff;color:#1b0b3a;" onclick="shareInstagramStoryOptimal()">ì¸ìŠ¤íƒ€ ê³µìœ í•˜ê¸°</button>
      <button class="btn share-x" style="margin-top:10px;" onclick="shareXImageOptimal()">X ê³µìœ í•˜ê¸°</button>
      <button class="btn secondary" style="margin-top:10px;" onclick="copyTestLink()">ë§í¬ ë³µì‚¬í•˜ê¸°</button>

      <div id="share-status" style="margin-top:12px;font-size:12px;color:#777;min-height:18px;"></div>
      <button class="btn secondary" style="margin-top:12px;" onclick="closeSharePopup()">ë‹«ê¸°</button>
    </div>
  </div>

<script>
  /* ========= ê³µí†µ ì„¤ì • ========= */
  const SITE_URL = "https://bongstudiosad.com";
  const TEST_URL = `${SITE_URL}/tests/test2/`;

  /* ========= âœ… AdFit ì•ˆì „ ë Œë”ëŸ¬ ========= */
  const ADFIT_UNIT_TEST2 = "DAN-J34OMc0GSbFbswgK";

  function ensureAdFitScriptOnce() {
    if (document.getElementById("kakao-adfit-script")) return;
    const s = document.createElement("script");
    s.id = "kakao-adfit-script";
    s.async = true;
    s.src = "https://t1.daumcdn.net/kas/static/ba.min.js";
    document.head.appendChild(s);
  }

  function renderAdFit(unitId) {
    const slot = document.getElementById("adfit-slot");
    if (!slot) return;

    slot.innerHTML = `
      <ins class="kakao_ad_area" style="display:none;"
        data-ad-unit="${unitId}"
        data-ad-width="320"
        data-ad-height="50"></ins>
    `;

    ensureAdFitScriptOnce();
  }

  /* ========= ê²°ê³¼ ì´ë¯¸ì§€ ========= */
  const resultMeta = {
    witch:   { title:"ë§ˆë…€ë´‰",   desc:"ì „ëµ&ì‹ ì¤‘ Â· ëª¨ë“  ê±´ ì „ë¶€ ë‚´ ê³„ì‚° ì•„ë˜.", imageUrl:`${SITE_URL}/img/result_witch.png` },
    mummy:   { title:"ë¯¸ë¼ë´‰",   desc:"ì¸ë‚´&ì§€ì† Â· ë‚˜ëŠ” ì‰½ê²Œ ë¬´ë„ˆì§€ì§€ ì•Šì•„.", imageUrl:`${SITE_URL}/img/result_mummy.png` },
    bat:     { title:"ë°•ì¥ë´‰",   desc:"ììœ &ì¦‰í¥ Â· ì§€ê¸ˆ ì´ ìˆœê°„ì´ ì œì¼ ì¤‘ìš”í•´.", imageUrl:`${SITE_URL}/img/result_bat.png` },
    ghost:   { title:"ìœ ë ¹ë´‰",   desc:"ê´€ì°°&ì¡´ì¬ê° Â· ì¡°ìš©í•˜ì§€ë§Œ, ë¹ ì§€ì§„ ì•Šì•„.", imageUrl:`${SITE_URL}/img/result_ghost.png` },
    reaper:  { title:"ì €ìŠ¹ë´‰",   desc:"ê¸°ì¤€&íŒë‹¨ Â· ì„ ì€ ì—¬ê¸°ê¹Œì§€ì•¼.", imageUrl:`${SITE_URL}/img/result_reaper.png` },
    franken: { title:"í”„ë‘ì¼„ë´‰", desc:"ì‹¤í–‰&ì±…ì„ Â· ë§ë³´ë‹¤ ë‚´ê°€ ë¨¼ì € ì›€ì§ì´ì§€.", imageUrl:`${SITE_URL}/img/result_franken.png` },
    pumpkin: { title:"íŒí‚¨ë´‰",   desc:"ë¶„ìœ„ê¸°&ì¡´ì¬ê° Â· ë‚˜ ì—†ìœ¼ë©´ ì¡°ìš©í•˜ì§€ ì•Šì•„?", imageUrl:`${SITE_URL}/img/result_pumpkin.png` },
    fox:     { title:"êµ¬ë¯¸í˜¸ë´‰", desc:"ì†Œí†µ&ì¡°ìœ¨ Â· ë§ë¡œ ì•ˆ ë˜ëŠ” ì¼ì€ ê±°ì˜ ì—†ì–´.", imageUrl:`${SITE_URL}/img/result_fox.png` },
    count:   { title:"ë°±ì‘ë´‰",   desc:"ì„ ê¸‹ê¸°&í’ˆìœ„ Â· ì•„ë¬´ ë°ì„œë‚˜ ë‚˜ì„œì§„ ì•Šì•„.", imageUrl:`${SITE_URL}/img/result_count_ghost.png` }
  };

  const nameToKey = {
    "ë§ˆë…€ë´‰":"witch","ë¯¸ë¼ë´‰":"mummy","ë°•ì¥ë´‰":"bat","ìœ ë ¹ë´‰":"ghost","ì €ìŠ¹ë´‰":"reaper",
    "í”„ë‘ì¼„ë´‰":"franken","íŒí‚¨ë´‰":"pumpkin","êµ¬ë¯¸í˜¸ë´‰":"fox","ë°±ì‘ë´‰":"count"
  };

  const monsterTheme = {
    witch:{ bg:"#2c1b54" }, mummy:{ bg:"#4a2d1f" }, bat:{ bg:"#15151f" }, ghost:{ bg:"#3a2a77" },
    reaper:{ bg:"#101018" }, franken:{ bg:"#2a5a43" }, pumpkin:{ bg:"#8c3b00" }, fox:{ bg:"#6d0f5a" }, count:{ bg:"#3c0f0f" }
  };

  function applyTheme(key) {
    const t = monsterTheme[key] || monsterTheme.witch;
    document.documentElement.style.setProperty("--themeColor", t.bg);
  }

  const resultDetail = {
    witch:{ oneline:"â€œë‚´ê°€ ìˆì–´ì•¼ ì´ ë¬¸ì œë¥¼ ë¹ ë¥´ê²Œ í•´ê²°í•  ìˆ˜ ìˆì–´.â€", summary:"ë¨¸ë¦¬ë¡œ êµ´ë ¤ì„œ íŒì„ ì§œëŠ” íƒ€ì…. ê¸‰í• ìˆ˜ë¡ ì¹¨ì°©í•´ì§„ë‹¤.", traits:["ê³„íš ì„¸ìš°ëŠ” ê±° ì¢‹ì•„í•¨","ë¦¬ìŠ¤í¬ë¥¼ ë¨¼ì € ê³„ì‚°í•¨","ë§ì€ ì§§ê³  ê²°ê³¼ë¡œ ë³´ì—¬ì¤Œ"], actions:["ë‹¨í†¡ë°©ì—ì„œ ì •ë¦¬ ë‹´ë‹¹","ì—¬í–‰ ì¼ì •í‘œ ë‹´ë‹¹","ë¬¸ì œ ìƒê¸°ë©´ í•´ê²° ë£¨íŠ¸ë¶€í„° ë½‘ìŒ"], match:["ì €ìŠ¹ë´‰"], mismatch:["íŒí‚¨ë´‰"], comment:"ë„ˆ ì—†ìœ¼ë©´ ë‹¤ë“¤ ìš°ì™•ì¢Œì™•í•œë‹¤. ê·¼ë° ê°€ë”ì€ â€˜ëŒ€ì¶©ë„ ê´œì°®ì•„â€™ ëª¨ë“œë„ ì—°ìŠµí•´ë´." },
    mummy:{ oneline:"â€œë²„í‹°ëŠ” ê²Œ ë‚´ ì¬ëŠ¥ì´ì•¼.â€", summary:"ê¾¸ì¤€í•¨ìœ¼ë¡œ ì´ê¸°ëŠ” íƒ€ì…. ëŠë ¤ë„ ë©ˆì¶”ì§„ ì•ŠëŠ”ë‹¤.", traits:["í˜ì´ìŠ¤ ìœ ì§€ê°€ ê°•ì ","ê°ì • í”ë“¤ë ¤ë„ í•  ê±´ í•¨","ì¥ê¸°ì „ ê°•í•¨"], actions:["ë£¨í‹´ ì§€í‚¤ê¸°","ëê¹Œì§€ ì±…ì„ì§€ê¸°","ì¡°ìš©íˆ ì„±ê³¼ ë‚´ê¸°"], match:["ë°±ì‘ë´‰"], mismatch:["ë°•ì¥ë´‰"], comment:"ë„ˆëŠ” â€˜í•œ ë°©â€™ë³´ë‹¤ â€˜ê¾¸ì¤€í•¨â€™ìœ¼ë¡œ ì”¹ì–´ë¨¹ëŠ” íƒ€ì…." },
    bat:{ oneline:"â€œì¼ë‹¨ í•´ë³´ì! í•˜ë©´ ë˜ì§€ ë­.â€", summary:"ì¦‰í¥ê³¼ ììœ ë¡œ ì‚¬ëŠ” íƒ€ì…. ê¸°ì„¸ê°€ ë¬´ê¸°ë‹¤.", traits:["ê²°ì • ë¹ ë¦„","ê¸°ë¶„ ì¢‹ì€ ë°©í–¥ìœ¼ë¡œ íë¦„","ì¬ë°Œìœ¼ë©´ ëª°ì…"], actions:["ë²ˆê°œ ì•½ì† ì£¼ë„","ìƒˆë¡œìš´ ê±° ë¨¼ì € ì°ë¨¹","ë¶„ìœ„ê¸° ì‚´ë¦¬ê¸°"], match:["íŒí‚¨ë´‰"], mismatch:["ì €ìŠ¹ë´‰"], comment:"ë„ˆ ë•ë¶„ì— íŒì´ ì‚´ì•„ë‚œë‹¤. ëŒ€ì‹  â€˜ì•½ì†/ì‹œê°„â€™ì€ í•œ ë²ˆë§Œ ë” ì²´í¬!" },
    ghost:{ oneline:"â€œë‚˜ëŠ” ì¡°ìš©íˆâ€¦ ë‹¤ ë³´ê³  ìˆì—ˆì§€.â€", summary:"ê´€ì°°ë ¥ìœ¼ë¡œ ìƒí™©ì„ ì½ëŠ” íƒ€ì…. ì¡´ì¬ê°ì€ ì€ê·¼íˆ í¬ë‹¤.", traits:["ëˆˆì¹˜ ë¹ ë¦„","í˜¼ì ì •ë¦¬í•˜ëŠ” ì‹œê°„ í•„ìš”","ë§ë³´ë‹¤ í–‰ë™"], actions:["ë¶„ìœ„ê¸° íŒŒì•…","ì •ë¦¬í•´ì„œ í•œ ë§ˆë””","í‹° ì•ˆ ë‚˜ê²Œ ë„ì›€"], match:["ë°±ì‘ë´‰"], mismatch:["íŒí‚¨ë´‰"], comment:"ë„ˆëŠ” â€˜ì¡°ìš©í•œ í•´ê²°ì‚¬â€™ í¬ì§€ì…˜ì´ ë”±ì´ë‹¤." },
    reaper:{ oneline:"â€œì—¬ê¸° ì„  ë„˜ìœ¼ë©´ ë°”ë¡œ ì»·.â€", summary:"ê¸°ì¤€ì´ í™•ì‹¤í•œ íƒ€ì…. ì• ë§¤í•œ ê±¸ ì‹«ì–´í•œë‹¤.", traits:["ì›ì¹™ ì¤‘ìš”","ì •ë¦¬/ë£° ì„¸ìš°ê¸°","ë¶ˆí•„ìš”í•œ ê°ì •ì†Œëª¨ ì»·"], actions:["ê·œì¹™ ë§Œë“¤ê¸°","ìš°ì„ ìˆœìœ„ ì •í•˜ê¸°","ì„  ê¸‹ê³  ì§€í‚¤ê¸°"], match:["ë§ˆë…€ë´‰"], mismatch:["ë°•ì¥ë´‰"], comment:"ë„ˆ ë•ë¶„ì— íŒ€ì´ ì•ˆì •ëœë‹¤. ëŒ€ì‹  ê°€ë”ì€ â€˜ì‚¬ëŒ ê¸°ë¶„â€™ë„ í•œ ë²ˆë§Œ ë´ì¤˜." },
    franken:{ oneline:"â€œë§ë³´ë‹¤ ì‹¤í–‰. ë‚´ê°€ ë¨¼ì € ì›€ì§ì¼ê²Œ.â€", summary:"ì‹¤í–‰ë ¥ìœ¼ë¡œ íŒì„ ë°”ê¾¸ëŠ” íƒ€ì…. ì±…ì„ê°ì´ ê°•í•˜ë‹¤.", traits:["ì‹¤ì²œí˜•","ì±…ì„ê°","ê²°ì •í•˜ë©´ ë°€ì–´ë¶™ì„"], actions:["ì¼ ì²˜ë¦¬ ìŠ¤íƒ€í„°","ë¬¸ì œ í•´ê²° ì‹¤ë¬´","í•„ìš”í•˜ë©´ ëª¸ìœ¼ë¡œ ë§‰ìŒ"], match:["ì €ìŠ¹ë´‰"], mismatch:["ìœ ë ¹ë´‰"], comment:"ë„ˆëŠ” â€˜í˜„ì¥í˜• ë¦¬ë”â€™ ì¬ì§ˆì´ë‹¤." },
    pumpkin:{ oneline:"â€œë‚˜ ì—†ìœ¼ë©´ ì¬ë¯¸ê°€ ì—†ì–ì•„?â€", summary:"ë¶„ìœ„ê¸°ë©”ì´ì»¤ íƒ€ì…. ì¡´ì¬ê° ìì²´ê°€ ì½˜í…ì¸ .", traits:["ì„¼ìŠ¤ ì¢‹ìŒ","ë“œë¦½/ì—°ì¶œ","ì‚¬ëŒ ëª¨ì´ê²Œ í•¨"], actions:["í–‰ì‚¬ ê¸°íš","ì‚¬ì§„/ì˜ìƒ ê° ì¡ê¸°","ì‚¬ëŒ í…ì…˜ ì˜¬ë¦¬ê¸°"], match:["ë°•ì¥ë´‰"], mismatch:["ë§ˆë…€ë´‰"], comment:"ë„ˆëŠ” ë“±ì¥ë§Œ í•´ë„ ë¶„ìœ„ê¸°ê°€ ë°”ë€ë‹¤. ëŒ€ì‹  ê³¼ëª°ì…ìœ¼ë¡œ ì—ë„ˆì§€ ë°©ì „ ì¡°ì‹¬!" },
    fox:{ oneline:"â€œë§ë¡œ í’€ì. ë‹¤ ë°©ë²• ìˆì–´.â€", summary:"ì†Œí†µìœ¼ë¡œ ê°ˆë“±ì„ ì¤„ì´ëŠ” íƒ€ì…. ì¡°ìœ¨ ëŠ¥ë ¥ì´ ê°•í•˜ë‹¤.", traits:["ì¤‘ì¬","ëˆˆì¹˜+ë§ì„¼ìŠ¤","í˜‘ìƒ ì˜í•¨"], actions:["ì‹¸ì›€ ë‚˜ê¸° ì „ ì§„ì••","ì„œë¡œ ë‚©ë“ì‹œí‚¤ê¸°","ë¶€ë“œëŸ½ê²Œ ëŒê³  ê°€ê¸°"], match:["ë°•ì¥ë´‰"], mismatch:["ì €ìŠ¹ë´‰"], comment:"ë„ˆëŠ” â€˜ê´€ê³„ ìš´ì˜â€™ ëŠ¥ë ¥ì¹˜ê°€ ë†’ë‹¤." },
    count:{ oneline:"â€œí’ˆìœ„ëŠ” ì§€í‚¤ë©´ì„œ, ì„ ì€ í™•ì‹¤íˆ.â€", summary:"ì„  ê¸‹ê³  ìê¸° í˜ì´ìŠ¤ ì§€í‚¤ëŠ” íƒ€ì…. ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ê±°ë¦¬ê°.", traits:["ë‚´ ê¸°ì¤€ì´ ìˆìŒ","ë¶ˆí•„ìš”í•œ ì†Œë€ ì‹«ìŒ","ì„ íƒê³¼ ì§‘ì¤‘"], actions:["í•„ìš”í•  ë•Œë§Œ ë“±ì¥","í•µì‹¬ë§Œ ë§í•˜ê¸°","ê´€ê³„ ì—ë„ˆì§€ ê´€ë¦¬"], match:["ë¯¸ë¼ë´‰"], mismatch:["íŒí‚¨ë´‰"], comment:"ë„ˆëŠ” â€˜ì¡°ìš©í•œ ìƒìœ„ê¶Œâ€™ ëŠë‚Œ. ë”± í•„ìš”í•œ ë§Œí¼ë§Œ í•œë‹¤." }
  };

  function nl2br(text) { return (text || "").replace(/\n/g, "<br>"); }
  function listToLines(arr) {
    if (!arr || !arr.length) return "â€¢ (í•´ë‹¹ ì—†ìŒ)";
    return arr.map(v => `â€¢ ${v}`).join("<br>");
  }

  function setCompat(side, name) {
    const key = nameToKey[name];
    const meta = key ? resultMeta[key] : null;

    const imgEl = document.getElementById(side === "match" ? "match-img" : "mismatch-img");
    const nameEl = document.getElementById(side === "match" ? "match-name" : "mismatch-name");
    if (!imgEl || !nameEl) return;

    nameEl.textContent = name || "";
    if (meta && meta.imageUrl) { imgEl.src = meta.imageUrl; imgEl.alt = name || ""; }
    else { imgEl.removeAttribute("src"); imgEl.alt = ""; }
  }

  const pages = {
    intro: document.getElementById("page-intro"),
    quiz: document.getElementById("page-quiz"),
    loading: document.getElementById("page-loading"),
    result: document.getElementById("page-result"),
  };

  function showPage(name) {
    Object.values(pages).forEach(p => p.classList.add("hidden"));
    pages[name].classList.remove("hidden");
    window.scrollTo({ top: 0 });

    // âœ… ì¸íŠ¸ë¡œ ì˜ìƒ ë¬´í•œì¬ìƒ ìœ ì§€
    if (name === "intro") {
      const v = document.getElementById("intro-video");
      if (v) {
        v.loop = true; v.muted = true; v.playsInline = true;
        setTimeout(() => {
          try { v.currentTime = 0; } catch(e){}
          const p = v.play();
          if (p && p.catch) p.catch(() => {});
        }, 50);
      }
    }

    // âœ… ê²°ê³¼ í˜ì´ì§€ ì§„ì…í•  ë•Œ ì—ë“œí• ë Œë”
    if (name === "result") {
      setTimeout(() => renderAdFit(ADFIT_UNIT_TEST2), 0);
    }
  }

  /* ========= âœ… í€´ì¦ˆ ì§ˆë¬¸(6ë¬¸í•­ ì™„ì „ë³¸) ========= */
  const monsterQuestions = [
    {
      text: "ë‹¨í†¡ë°©ì— ê³µì§€ê°€ ì˜¬ë¼ì™”ëŠ”ë°â€¦ ë„ˆ ë°˜ì‘ì€?",
      options: [
        { label: "â€˜ì •ë¦¬í•´ì¤„ê²Œâ€™ í•˜ê³  í•µì‹¬ë§Œ ë”± ë½‘ì•„ì„œ ê³µìœ í•œë‹¤", scores:{ witch:3, reaper:2, franken:1 } },
        { label: "ì¼ë‹¨ ì½ê³ â€¦ ì¡°ìš©íˆ ìƒí™©ì„ ë³¸ë‹¤", scores:{ ghost:3, count:2, mummy:1 } },
        { label: "ë°ˆë¶€í„° ë˜ì§€ê³  ë¶„ìœ„ê¸° ì‚´ë¦°ë‹¤", scores:{ pumpkin:3, bat:2, fox:1 } }
      ]
    },
    {
      text: "ê°‘ìê¸° ì¼ì •ì´ ë°”ë€Œì—ˆë‹¤. ë„ˆëŠ”?",
      options: [
        { label: "ëŒ€ì²´ í”Œëœì„ ë°”ë¡œ ì§ ë‹¤ (í”ŒëœB, í”ŒëœCâ€¦)", scores:{ witch:3, reaper:2, mummy:1 } },
        { label: "ê·¸ëƒ¥ ë°”ë€ëŒ€ë¡œ ì¦ê¸´ë‹¤. ì˜¤íˆë ¤ ì¢‹ì•„!", scores:{ bat:3, pumpkin:2, fox:1 } },
        { label: "ì¼ë‹¨ ë‚´ê°€ í•  ìˆ˜ ìˆëŠ” ì‹¤ë¬´ë¶€í„° ì²˜ë¦¬í•œë‹¤", scores:{ franken:3, mummy:2, ghost:1 } }
      ]
    },
    {
      text: "ì‚¬ëŒ ë§ì€ ìë¦¬ì—ì„œ ë„ˆì˜ í¬ì§€ì…˜ì€?",
      options: [
        { label: "ë§ì€ ì ê²Œ, í•„ìš”í•œ ìˆœê°„ì—ë§Œ í•œ ë°©", scores:{ count:3, ghost:2, reaper:1 } },
        { label: "ë¶„ìœ„ê¸° ë„ìš°ê³  ì‚¬ëŒ ëª¨ìœ¼ëŠ” ì—­í• ", scores:{ pumpkin:3, bat:2, fox:1 } },
        { label: "ëˆ„ê°€ ë­˜ í•´ì•¼í• ì§€ ìì—°ìŠ¤ëŸ½ê²Œ ì •ë¦¬í•¨", scores:{ witch:3, franken:2, reaper:1 } }
      ]
    },
    {
      text: "ì¼ì´ ê¼¬ì˜€ì„ ë•Œ ë„ˆëŠ” ì–´ë–¤ íƒ€ì…?",
      options: [
        { label: "ê°ì •ì€ ì ê¹ ì ‘ê³ , í•´ê²° ë£¨íŠ¸ë¶€í„° ë½‘ëŠ”ë‹¤", scores:{ witch:3, franken:2, reaper:1 } },
        { label: "ë²„í‹°ë©´ì„œ í•˜ë‚˜ì”© ëê¹Œì§€ ì •ë¦¬í•œë‹¤", scores:{ mummy:3, count:2, ghost:1 } },
        { label: "ì‚¬ëŒë“¤ í…ì…˜ë¶€í„° ì‚´ë¦¬ê³  ë‹¤ì‹œ ìŠ¤íƒ€íŠ¸", scores:{ pumpkin:3, fox:2, bat:1 } }
      ]
    },
    {
      text: "ëˆ„ê°€ ì„  ë„˜ëŠ” ë§ì„ í–ˆë‹¤. ë„ˆëŠ”?",
      options: [
        { label: "ê·¸ ìë¦¬ì—ì„œ ì„ ì„ ë”± ê¸‹ëŠ”ë‹¤", scores:{ reaper:3, count:2, franken:1 } },
        { label: "ìƒí™©ì„ ë¶€ë“œëŸ½ê²Œ ì •ë¦¬í•˜ê³  ëŒ€í™”ë¡œ í‘¼ë‹¤", scores:{ fox:3, witch:1, ghost:1 } },
        { label: "ì¼ë‹¨ ì°¸ëŠ”ë‹¤â€¦ ë‚˜ì¤‘ì— ì¡°ìš©íˆ ê±°ë¦¬ë¥¼ ë‘”ë‹¤", scores:{ ghost:3, mummy:2, count:1 } }
      ]
    },
    {
      text: "ë„ˆì˜ â€˜íœ´ì‹â€™ì€ ì–´ë–¤ ëŠë‚Œì´ì•¼?",
      options: [
        { label: "í˜¼ì ìˆëŠ” ì‹œê°„ì´ ìˆì–´ì•¼ íšŒë³µë¨", scores:{ ghost:3, count:2, mummy:1 } },
        { label: "ë°–ì— ë‚˜ê°€ì„œ ë†€ì•„ì•¼ í’€ë¦¼", scores:{ bat:3, pumpkin:2, fox:1 } },
        { label: "ì •ë¦¬/ê³„íš ì„¸ìš°ë©´ ë§ˆìŒì´ í¸í•´ì§", scores:{ witch:3, reaper:2, franken:1 } }
      ]
    }
  ];

  const scoreState = { witch:0,mummy:0,bat:0,ghost:0,reaper:0,franken:0,pumpkin:0,fox:0,count:0 };
  let currentIndex = 0;
  let currentResultKey = "witch";

  const qText = document.getElementById("question-text");
  const optionsWrap = document.getElementById("options-wrap");
  const progressText = document.getElementById("progress-text");
  const progressBar = document.getElementById("progress-bar");

  function resetScores() { Object.keys(scoreState).forEach(k => scoreState[k] = 0); }

  function startQuiz() {
    // âœ… ì§ˆë¬¸ì´ ë¹„ì–´ìˆì„ ë•Œë„ ë²„íŠ¼ì´ â€œì£½ì§€ ì•Šê²Œâ€ ë°©ì–´
    if (!monsterQuestions || monsterQuestions.length === 0) {
      alert("ì§ˆë¬¸ ë°ì´í„°ê°€ ë¹„ì–´ìˆì–´ìš”. monsterQuestionsë¥¼ ì±„ì›Œì£¼ì„¸ìš”!");
      return;
    }

    const v = document.getElementById("intro-video");
    try { if (v) v.pause(); } catch(e){}

    currentIndex = 0;
    currentResultKey = "witch";
    resetScores();
    resetShareCache();
    renderQuestion();
    showPage("quiz");
  }

  function renderQuestion() {
    const q = monsterQuestions[currentIndex];
    if (!q) return;

    qText.textContent = q.text || "";
    progressText.textContent = `${currentIndex + 1} / ${monsterQuestions.length}`;
    progressBar.style.width = `${((currentIndex + 1) / monsterQuestions.length) * 100}%`;

    optionsWrap.innerHTML = "";
    [...(q.options || [])].sort(() => Math.random() - 0.5).forEach(opt => {
      const btn = document.createElement("button");
      btn.className = "option-btn";
      btn.type = "button";
      btn.textContent = opt.label || "";
      btn.onclick = () => selectOption(opt.scores || {});
      optionsWrap.appendChild(btn);
    });
  }

  function addScores(scoresObj) {
    for (const [k, v] of Object.entries(scoresObj || {})) {
      if (scoreState[k] == null) continue;
      scoreState[k] += Number(v) || 0;
    }
  }

  function selectOption(scoresObj) {
    addScores(scoresObj);
    if (currentIndex < monsterQuestions.length - 1) {
      currentIndex++;
      renderQuestion();
    } else {
      showPage("loading");
      setTimeout(() => {
        calculateResult();
        showPage("result");
      }, 3000);
    }
  }

  function setResultImage(url) {
    const img = document.getElementById("poster-image");
    if (!img) return;
    img.crossOrigin = "anonymous";
    img.src = url;
  }

  function getCurrentMeta() { return resultMeta[currentResultKey] || resultMeta.witch; }

  function renderResultDetail() {
    const meta = getCurrentMeta();
    const detail = resultDetail[currentResultKey] || resultDetail.witch;

    applyTheme(currentResultKey);

    const titleEl = document.getElementById("result-title");
    if (titleEl) titleEl.textContent = meta.title;

    const ph = document.getElementById("poster-header");
    if (ph) ph.textContent = meta.title;

    setResultImage(meta.imageUrl);

    document.getElementById("detail-oneline").innerHTML = nl2br(detail.oneline);
    document.getElementById("detail-summary").innerHTML = nl2br(detail.summary);
    document.getElementById("detail-traits").innerHTML = listToLines(detail.traits);
    document.getElementById("detail-actions").innerHTML = listToLines(detail.actions);
    document.getElementById("detail-comment").innerHTML = nl2br(detail.comment);

    const matchName = (detail.match && detail.match[0]) ? detail.match[0] : "";
    const mismatchName = (detail.mismatch && detail.mismatch[0]) ? detail.mismatch[0] : "";
    setCompat("match", matchName);
    setCompat("mismatch", mismatchName);
  }

  function calculateResult() {
    let bestKey = "witch";
    let bestScore = -Infinity;
    for (const [k, v] of Object.entries(scoreState)) {
      if (v > bestScore) { bestScore = v; bestKey = k; }
    }
    const tied = Object.entries(scoreState).filter(([k,v]) => v === bestScore).map(([k]) => k);
    if (tied.length > 1) bestKey = tied[Math.floor(Math.random() * tied.length)];

    currentResultKey = bestKey;
    renderResultDetail();
    resetShareCache();
  }

  function restartQuiz() {
    closeSharePopup();
    resetShareCache();
    startQuiz();
  }

  /* ========= ê³µìœ (ì—ëŸ¬ ë°©ì§€ ê¸°ë³¸ë™ì‘) ========= */
  const SHARE = { busy:false };
  function setShareStatus(msg){ const el=document.getElementById("share-status"); if(el) el.textContent=msg||""; }
  function resetShareCache(){ SHARE.busy=false; setShareStatus(""); }

  function openSharePopup(){
    const pop = document.getElementById("share-popup");
    if (pop) pop.classList.remove("hidden");
    setShareStatus("ì›í•˜ëŠ” ì±„ë„ì„ ì„ íƒí•´ì¤˜!");
  }
  function closeSharePopup(){
    const pop = document.getElementById("share-popup");
    if (pop) pop.classList.add("hidden");
    setShareStatus("");
  }

  async function copyTestLink(){
    try{
      await navigator.clipboard.writeText(TEST_URL);
      setShareStatus("âœ… ë§í¬ë¥¼ ë³µì‚¬í–ˆì–´!");
    }catch(e){
      setShareStatus("ë³µì‚¬ ì‹¤íŒ¨! ì•„ë˜ ë§í¬ë¥¼ ê¸¸ê²Œ ëˆŒëŸ¬ ë³µì‚¬í•´ì¤˜: " + TEST_URL);
    }
  }

  function shareKakao(){
    try{
      if (!window.Kakao || !Kakao.isInitialized()) {
        setShareStatus("ì¹´ì¹´ì˜¤ SDKê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ì–´.");
        return;
      }
      const meta = getCurrentMeta();
      const shareUrl = `${TEST_URL}?r=${encodeURIComponent(currentResultKey)}`;

      Kakao.Share.sendDefault({
        objectType: "feed",
        content: {
          title: `ëª¬ìŠ¤í„° ì„¸ìƒ ì† ë‚˜ëŠ”? - ${meta.title}`,
          description: `${meta.desc}\n\nğŸ‘‰ í…ŒìŠ¤íŠ¸ í•˜ëŸ¬ê°€ê¸°`,
          imageUrl: meta.imageUrl,
          link: { mobileWebUrl: shareUrl, webUrl: shareUrl }
        },
        buttons: [
          { title: "í…ŒìŠ¤íŠ¸ í•˜ëŸ¬ê°€ê¸°", link: { mobileWebUrl: shareUrl, webUrl: shareUrl } }
        ]
      });
      setShareStatus("âœ… ì¹´ì¹´ì˜¤í†¡ ê³µìœ ì°½ì„ ì—´ì—ˆì–´!");
    }catch(e){
      console.warn(e);
      setShareStatus("ì¹´ì¹´ì˜¤ ê³µìœ  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´.");
    }
  }

  async function shareInstagramStoryOptimal(){
    // ì›¹ì—ì„œ â€˜ì¸ìŠ¤íƒ€ ìŠ¤í† ë¦¬ë¡œ ë°”ë¡œ ì˜¬ë¦¬ê¸°â€™ëŠ” ë¸Œë¼ìš°ì €ê°€ ê°•í•˜ê²Œ ì œí•œí•¨
    // ëŒ€ì‹ : (ì§€ì› ê¸°ê¸°) Web Shareë¡œ ê³µìœ  ì‹œíŠ¸ ì—´ê¸° / (ë¯¸ì§€ì›) ë§í¬ ì•ˆë‚´
    try{
      const meta = getCurrentMeta();
      const shareUrl = `${TEST_URL}?r=${encodeURIComponent(currentResultKey)}`;

      if (navigator.share) {
        await navigator.share({
          title: `ëª¬ìŠ¤í„° íƒ€ì…: ${meta.title}`,
          text: `${meta.desc}\n${shareUrl}`,
          url: shareUrl
        });
        setShareStatus("âœ… ê³µìœ  ì‹œíŠ¸ë¥¼ ì—´ì—ˆì–´! ì¸ìŠ¤íƒ€ ì„ íƒí•´ì¤˜.");
        return;
      }
      setShareStatus("ì´ ê¸°ê¸°ì—ì„œëŠ” ìë™ ê³µìœ ê°€ ì–´ë ¤ì›Œ. ë§í¬ ë³µì‚¬ í›„ ì¸ìŠ¤íƒ€ì— ë¶™ì—¬ë„£ì–´ì¤˜!");
    }catch(e){
      console.warn(e);
      setShareStatus("ê³µìœ ê°€ ì·¨ì†Œë˜ì—ˆê±°ë‚˜ ì‹¤íŒ¨í–ˆì–´. ë§í¬ ë³µì‚¬ë¡œ ì§„í–‰í•´ì¤˜!");
    }
  }

  async function shareXImageOptimal(){
    try{
      const meta = getCurrentMeta();
      const shareUrl = `${TEST_URL}?r=${encodeURIComponent(currentResultKey)}`;
      const text = encodeURIComponent(`ë‚´ ëª¬ìŠ¤í„° íƒ€ì…ì€ "${meta.title}" ğŸ‘¾\n${meta.desc}\n\n${shareUrl}`);
      window.open(`https://twitter.com/intent/tweet?text=${text}`, "_blank");
      setShareStatus("âœ… X ê³µìœ ì°½ì„ ì—´ì—ˆì–´!");
    }catch(e){
      console.warn(e);
      setShareStatus("X ê³µìœ  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´.");
    }
  }

  /* ========= ì²« ì§„ì… ì²˜ë¦¬ ========= */
  (function bootFromShareLink(){
    try{
      const r = new URLSearchParams(location.search).get("r");
      if (r && resultMeta[r]) {
        currentResultKey = r;
        renderResultDetail();
        resetShareCache();
        showPage("result");
        return;
      }
      showPage("intro");
    }catch(e){
      console.warn(e);
      showPage("intro");
    }
  })();
</script>

<script src="/common/common.js"></script>
</body>
</html>
