<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ì˜¤ëª©ì™•! ë©§ë´‰ì´ë¥¼ ì´ê²¨ë¼!</title>

  <meta name="description" content="ì„¤ì¹˜ ì—†ì´ ë°”ë¡œ ì¦ê¸°ëŠ” 15Ã—15 ì˜¤ëª© ê²Œì„! ì—¬ë´‰ì´ vs ë©§ë´‰ì´, 5ëª©ì„ ë¨¼ì € ë§Œë“¤ë©´ ìŠ¹ë¦¬!" />
  <link rel="canonical" href="https://bongstudiosad.com/games/omok/" />

  
  <style>
    :root{
      --bg:#0b0f19;
      --card:rgba(255,255,255,.08);
      --line:rgba(255,255,255,.14);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);
      --btn:rgba(255,255,255,.10);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background: radial-gradient(1200px 700px at 50% -100px, rgba(255,255,255,.14), transparent 65%),
                  radial-gradient(1000px 600px at 10% 110%, rgba(255,255,255,.10), transparent 60%),
                  var(--bg);
      color:var(--text);
    }

    /* NAV / FOOTER */
    .global-nav{
      position:sticky; top:0; z-index:1000;
      background:rgba(11,15,25,.75);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(255,255,255,.12);
    }
    .nav-inner{
      max-width:560px; margin:0 auto;
      padding:12px 14px;
      display:flex; align-items:center; justify-content:space-between;
    }
    .nav-logo{
      font-weight:900; font-size:14px;
      color:#fff; text-decoration:none;
    }
    .nav-links a{
      margin-left:14px;
      font-size:13px; font-weight:800;
      color:rgba(255,255,255,.75);
      text-decoration:none;
    }
    .nav-links a:hover{ color:#fff; }

    .global-footer{
      margin-top:40px;
      padding:24px 16px 40px;
      text-align:center;
      color:rgba(255,255,255,.55);
      font-size:12px;
    }
    .global-footer .small{
      margin-top:6px;
      font-size:11px;
      color:rgba(255,255,255,.4);
    }
    .global-footer .footer-links{
  margin-top:10px;
  display:flex;
  gap:8px;
  justify-content:center;
  align-items:center;
  flex-wrap:wrap;
  font-size:12px;
}
.global-footer .footer-links a{
  color:rgba(255,255,255,.72);
  text-decoration:none;
  font-weight:900;
}
.global-footer .footer-links a:hover{
  color:#fff;
  text-decoration:underline;
}
.global-footer .footer-links .sep{
  color:rgba(255,255,255,.35);
  font-weight:900;
}

    /* APP */
    .app{
      max-width:760px;
      margin:0 auto;
      padding:16px 14px 22px;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:calc(100vh - 56px);
    }
    .header{
      padding:14px 14px;
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border-radius:18px;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
    }
    .topRow{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .title{ margin:0; font-size:18px; font-weight:900; letter-spacing:-.2px; }
    .sub{ margin:6px 0 0; font-size:12px; color:var(--muted); line-height:1.35; }
    .faces{ display:flex; align-items:center; gap:8px; flex-shrink:0; }
    .face{
      width:28px; height:28px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.25);
      background:rgba(255,255,255,.10);
      object-fit:cover;
    }
    .vs{ font-size:11px; color:var(--muted); font-weight:900; }

    .controls{ margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.18);
      background:var(--btn);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      font-weight:900;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      backdrop-filter: blur(8px);
    }
    .btn:active{ transform:translateY(1px); }
    .btn.primary{
      background:rgba(255,255,255,.92);
      color:#0b0f19;
      border-color:rgba(255,255,255,.92);
    }
    .btn:disabled{ opacity:.45; cursor:not-allowed; transform:none; }

    .chip{
      margin-left:auto;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background:var(--card);
      font-size:12px;
      font-weight:900;
      color:var(--text);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;
      background:rgba(255,255,255,.85);
      box-shadow:0 0 0 4px rgba(255,255,255,.10);
    }

   .boardCard{
  border:1px solid var(--line);
  background:linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.05));
  border-radius:20px;
  padding:8px; /* âœ… 14px â†’ 8px (ëª¨ë°”ì¼ ì²´ê° í™• ì»¤ì§) */
  box-shadow:0 12px 34px rgba(0,0,0,.28);
}
    .boardWrap{display:flex; align-items:center; justify-content:center; padding:0;}
    canvas{
  width:100%;
  height:auto;
  aspect-ratio:1 / 1;

  border-radius:18px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(255,255,255,.92);
  box-shadow:0 14px 28px rgba(0,0,0,.28);
  touch-action:none;
}

    .footer{
      border:1px solid var(--line);
      background:var(--card);
      border-radius:18px;
      padding:12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .msg{ font-weight:900; font-size:13px; letter-spacing:-.1px; }
    .hint{ font-size:12px; color:var(--muted); font-weight:800; white-space:nowrap; }

    /* MODAL */
    .modal-backdrop{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:9999;
    }
    .modal-backdrop.show{ display:flex; }
    .modal{
      width:min(420px, 92vw);
      border-radius:22px;
      border:1px solid rgba(255,255,255,.20);
      background:linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
      box-shadow:0 22px 60px rgba(0,0,0,.55);
      padding:16px 16px 14px;
      backdrop-filter: blur(10px);
      transform: translateY(8px) scale(.98);
      opacity:.98;
      animation: pop .16s ease-out forwards;
    }
    @keyframes pop{ to{ transform: translateY(0) scale(1); opacity:1; } }
    .modalTitle{ margin:0; font-size:18px; font-weight:1000; letter-spacing:-.2px; }
    .modalDesc{ margin:8px 0 0; font-size:12px; color:var(--muted); font-weight:800; line-height:1.45; }
    .modalBtns{ display:flex; gap:8px; margin-top:14px; }
    .modalBtns .btn{ flex:1; justify-content:center; }

    /* Start choice */
    .choice-row{ display:flex; gap:8px; margin-top:12px; }
    .choice{
      flex:1;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.10);
      color:rgba(255,255,255,.92);
      padding:12px 12px;
      border-radius:16px;
      font-weight:1000;
      font-size:14px;
      cursor:pointer;
      user-select:none;
      text-align:center;
    }
    .choice small{
      display:block;
      margin-top:6px;
      font-weight:800;
      font-size:12px;
      color:rgba(255,255,255,.65);
      letter-spacing:-.1px;
    }
    .choice.active{
      background:rgba(255,255,255,.92);
      color:#0b0f19;
      border-color:rgba(255,255,255,.92);
    }
    .choice.active small{ color:rgba(11,15,25,.65); }

    /* âœ… 33 í† ìŠ¤íŠ¸(1.5ì´ˆ) */
    .toast33{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      z-index:10050; /* ëª¨ë‹¬ë³´ë‹¤ ìœ„ */
      pointer-events:none;
    }
    .toast33.show{ display:flex; }
    .toast33 .bubble{
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.20);
      background:linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
      box-shadow:0 18px 50px rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      font-weight:1000;
      letter-spacing:-.2px;
      color:rgba(255,255,255,.95);
      transform: translateY(8px) scale(.98);
      animation: toastPop .14s ease-out forwards;
    }
    @keyframes toastPop{
      to{ transform: translateY(0) scale(1); }
    }

      /* âœ… AdSenseìš©: ê²Œì„ ì„¤ëª… ì„¹ì…˜ (í‘¸í„° ìœ„) */
    .game-desc{
      margin-top: 14px;
      max-width:560px;
      margin-left:auto; margin-right:auto;
      width: calc(100% - 28px);
    
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.05));
      border-radius: 20px;
      padding: 14px 14px;
      box-shadow: 0 12px 34px rgba(0,0,0,.22);
    }
    .game-desc h2{
      margin: 0 0 8px;
      font-size: 16px;
      font-weight: 1000;
      letter-spacing: -.2px;
    }
    .game-desc h3{
      margin: 14px 0 6px;
      font-size: 13px;
      font-weight: 1000;
      color: rgba(255,255,255,.88);
    }
    .game-desc p{
      margin: 8px 0 0;
      font-size: 12px;
      line-height: 1.6;
      color: rgba(255,255,255,.72);
      font-weight: 800;
    }
    .game-desc ul{
      margin: 8px 0 0;
      padding-left: 18px;
      color: rgba(255,255,255,.72);
      font-size: 12px;
      line-height: 1.6;
      font-weight: 800;
    }
    .game-desc li{ margin: 4px 0; }

   @media (max-width: 480px){
  .sub{ display:none; }          /* âœ… í•œ ì¤„ ì„¤ëª… ìˆ¨ê¹€ */
  .header{ padding:10px 10px; }  /* âœ… í—¤ë” ë‚®ì¶”ê¸° */
  .controls{ margin-top:8px; gap:6px; }
  .btn{ padding:9px 10px; font-size:12px; } /* ë²„íŠ¼ ì‚´ì§ ì»´íŒ©íŠ¸ */
  .chip{ padding:8px 10px; font-size:11px; }
  .footer{ padding:10px 12px; }   

  /* âœ… ì—¬ê¸°! ì˜¤ëª©íŒ(ìº”ë²„ìŠ¤) ëª¨ë°”ì¼ í™•ëŒ€ */
  canvas{
    max-height: calc(100svh - 210px);
    width: min(100%, calc(100svh - 210px));
  }
}
    
  </style>

  <!-- Google AdSense -->
<script async
  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2371351351595028"
  crossorigin="anonymous"></script>

  
</head>

<body>
  <nav class="global-nav">
    <div class="nav-inner">
      <a href="/" class="nav-logo">ì—¬ë´‰ì´ì˜ ë†€ì´í„°</a>
      <div class="nav-links">
        <a href="/tests/">ì„±í–¥í…ŒìŠ¤íŠ¸</a>
        <a href="/games/omok/">ì˜¤ëª©ê²Œì„</a>
      </div>
    </div>
  </nav>

  <div class="app">
    <div class="header">
      <div class="topRow">
        <div>
          <h1 class="title">ë©§ë´‰ì´ë¥¼ ì´ê²¨ë¼!</h1>
          <div class="sub">í•œ ë²ˆ ëˆŒëŸ¬ì„œ ëŒ ë†“ê¸° Â· 5ëª© ë¨¼ì € ë§Œë“¤ë©´ ìŠ¹ë¦¬</div>
        </div>
        <div class="faces">
          <img class="face" id="p1Face" alt="ì—¬ë´‰ì´" />
          <span class="vs">VS</span>
          <img class="face" id="p2Face" alt="ë©§ë´‰ì´" />
        </div>
      </div>

      <div class="controls">
        <button class="btn primary" id="resetBtn">ë‹¤ì‹œí•˜ê¸°</button>
        <button class="btn" id="toggleFirstBtn">ì„ ê³µ: ì—¬ë´‰ì´</button>
        <div class="chip" id="turnChip"><span class="dot"></span><span>ì—¬ë´‰ì´ ì°¨ë¡€</span></div>
      </div>
    </div>

    <div class="boardCard">
      <div class="boardWrap">
        <canvas id="board" width="900" height="900" aria-label="ì˜¤ëª©íŒ"></canvas>
      </div>
    </div>

    <div class="footer">
      <div class="msg" id="msg">ì„ ê³µì„ ì„ íƒí•˜ê³  ì‹œì‘í•˜ê¸° ëˆŒëŸ¬ì¤˜!</div>
      <div class="hint" id="hint">15Ã—15</div>
    </div>
  </div>

  <!-- Result modal -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <h2 class="modalTitle" id="modalTitle">ìŠ¹ë¦¬!</h2>
      <div class="modalDesc" id="modalDesc">ë‹¤ì‹œ í•œ íŒ ê°€ì ğŸ˜</div>
      <div class="modalBtns">
        <button class="btn primary" id="modalRestartBtn">ë‹¤ì‹œí•˜ê¸°</button>
        <button class="btn" id="modalCloseBtn">ë‹«ê¸°</button>
      </div>
    </div>
  </div>


  <!-- âœ… AdSenseìš©: ê²Œì„ ì„¤ëª…(ê²Œì„ í•˜ë‹¨ & í‘¸í„° ìœ„) -->
  <section class="game-desc">
    <h2>ì˜¤ëª©ì™• ë©§ë´‰ì´ë¥¼ ì´ê²¨ë¼!</h2>
    <p>
      ì´ í˜ì´ì§€ëŠ” ì„¤ì¹˜ ì—†ì´ ë°”ë¡œ ì¦ê¸¸ ìˆ˜ ìˆëŠ” ì›¹ ê¸°ë°˜ ì˜¤ëª© ê²Œì„ì´ì•¼.
      ì§§ê²Œ í•œ íŒ í•˜ê¸° ì¢‹ì€ ì‹¬ì‹¬í’€ì´ ê²Œì„ìœ¼ë¡œ, ì—¬ë´‰ì´ì˜ ë†€ì´í„°ì—ì„œ ì œê³µí•˜ëŠ” ì½˜í…ì¸  ì¤‘ í•˜ë‚˜ì•¼.
    </p>

    <h3>ê²Œì„ ë°©ë²•</h3>
    <ul>
      <li>ì—¬ë´‰ì´(í”Œë ˆì´ì–´)ì™€ ë©§ë´‰ì´(AI)ê°€ ë²ˆê°ˆì•„ ëŒì„ ë†“ì•„.</li>
      <li>ê°€ë¡œÂ·ì„¸ë¡œÂ·ëŒ€ê°ì„ ìœ¼ë¡œ 5ê°œì˜ ëŒì„ ë¨¼ì € ë§Œë“¤ë©´ ìŠ¹ë¦¬!</li>
      <li>33(ë”ë¸” ì“°ë¦¬) ê¸ˆì§€ ê·œì¹™ì´ ì ìš©ë¼ì„œ, í•´ë‹¹ ìˆ˜ëŠ” â€œ33ì€ ì•ˆë¼!â€ ì•Œë¦¼ì´ ë– .</li>
    </ul>

    <p>
      ì ê¹ ì‰¬ëŠ” ì‹œê°„ì— ê°€ë³ê²Œ ì¦ê¸°ê¸° ì¢‹ì•„. ë©§ë´‰ì´ ìƒëŒ€ë¡œ ìŠ¹ë¦¬í•˜ë©´ ë„ˆ ì§„ì§œ ì˜¤ëª©ì™• ì¸ì • ğŸ˜
    </p>

  
  
  </section>

 

  <!-- Start modal -->
  <div class="modal-backdrop" id="startBackdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <h2 class="modalTitle">ì„ ê³µ ì„ íƒ</h2>
      <div class="modalDesc">ëˆ„ê°€ ë¨¼ì € ë‘˜ë˜? ì„ íƒí•˜ê³  <b>ì‹œì‘í•˜ê¸°</b> ëˆ„ë¥´ë©´ ë°”ë¡œ ì‹œì‘!</div>

      <div class="choice-row" id="startChoices">
        <div class="choice active" data-first="PLAYER">ë‚˜ (ì—¬ë´‰ì´)<small>ë¨¼ì € ë‘ê³  ì‹œì‘</small></div>
        <div class="choice" data-first="AI">ë©§ë´‰ì´<small>ìƒëŒ€ê°€ ë¨¼ì € ë‘ </small></div>
      </div>

      <div class="modalBtns">
        <button class="btn primary" id="startBtn">ì‹œì‘í•˜ê¸°</button>
      </div>
    </div>
  </div>

  <!-- âœ… 33 í† ìŠ¤íŠ¸ -->
  <div class="toast33" id="toast33" aria-live="polite">
    <div class="bubble" id="toast33Text">33ì€ ì•ˆë¼!</div>
  </div>

  <footer class="global-footer">
    <p>Â© 2026 ì—¬ë´‰ì´ì˜ ë†€ì´í„°</p>
    <p class="small">ì‹¬ì‹¬í•  ë•Œ ë§Œë“œëŠ” ì›¹ ì¥ë‚œê°</p>
      <div class="footer-links">
    <a href="/privacy/">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
    <span class="sep">Â·</span>
    <a href="/terms/">ì´ìš©ì•½ê´€</a>
    <span class="sep">Â·</span>
    <a href="/contact/">ë¬¸ì˜</a>
  </div>

  </footer>

<script>
(() => {
  // =========================
  // 15x15 + ë” ê°•í•œ AI
  // =========================
  const SIZE = 15;
  const WIN = 5;

  const PLAYER = 1;
  const AI = 2;

  const IMG_P1 = "/img/omok_player.png";
  const IMG_P2 = "/img/omok_ai.png";

  // âœ… ë‚œì´ë„ ìƒí–¥ ì„¸íŒ…
  const TARGET_WIN_RATE = 0.20;
  const AI_MIN = 0.68;
  const AI_MAX = 0.99;
  const ADJUST_K = 0.18;
  const MAX_SOFT_CHOICE = 6;

  const LS_KEY = "yeobong_omok_flash_15x15_hard_v1";
  const AI_DELAY = 700;

  const canvas = document.getElementById("board");
  const ctx = canvas.getContext("2d");

  const resetBtn = document.getElementById("resetBtn");
  const toggleFirstBtn = document.getElementById("toggleFirstBtn");
  const turnChip = document.getElementById("turnChip");
  const msgEl = document.getElementById("msg");

  const modalBackdrop = document.getElementById("modalBackdrop");
  const modalTitle = document.getElementById("modalTitle");
  const modalDesc = document.getElementById("modalDesc");
  const modalRestartBtn = document.getElementById("modalRestartBtn");
  const modalCloseBtn = document.getElementById("modalCloseBtn");

  const startBackdrop = document.getElementById("startBackdrop");
  const startChoices = document.getElementById("startChoices");
  const startBtn = document.getElementById("startBtn");

  // âœ… 33 í† ìŠ¤íŠ¸
  const toast33 = document.getElementById("toast33");
  const toast33Text = document.getElementById("toast33Text");
  let toastTimer = null;
  function showToast33(text="33ì€ ì•ˆë¼!", ms=1500){
    toast33Text.textContent = text;
    toast33.classList.add("show");
    if(toastTimer) clearTimeout(toastTimer);
    toastTimer = setTimeout(() => toast33.classList.remove("show"), ms);
  }

  const p1Face = document.getElementById("p1Face");
  const p2Face = document.getElementById("p2Face");
  p1Face.src = IMG_P1;
  p2Face.src = IMG_P2;

  function setMsg(t){ msgEl.textContent = t; }
  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
  function nameOf(p){ return p === PLAYER ? "ì—¬ë´‰ì´" : "ë©§ë´‰ì´"; }

  function openModal(title, desc){
    modalTitle.textContent = title;
    modalDesc.textContent = desc;
    modalBackdrop.classList.add("show");
  }
  function closeModal(){ modalBackdrop.classList.remove("show"); }

  function openStartModal(){ startBackdrop.classList.add("show"); }
  function closeStartModal(){ startBackdrop.classList.remove("show"); }

  function setControlsEnabled(on){
    resetBtn.disabled = !on;
    toggleFirstBtn.disabled = !on;
  }

  let board = Array.from({ length: SIZE }, () => Array(SIZE).fill(0));
  let gameStarted = false;
  let gameOver = false;

  let firstPlayer = PLAYER;
  let turn = PLAYER;
  let lastMove = null;

  let results = [];
  let difficulty = 0.90;

  function loadState(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return;
      const s = JSON.parse(raw);
      if(Array.isArray(s.results)) results = s.results.filter(x => x==="W" || x==="L").slice(-10);
      if(typeof s.difficulty === "number") difficulty = clamp(s.difficulty, AI_MIN, AI_MAX);
      if(s.firstPlayer === PLAYER || s.firstPlayer === AI) firstPlayer = s.firstPlayer;
    }catch(e){}
  }
  function saveState(){
    localStorage.setItem(LS_KEY, JSON.stringify({ results, difficulty, firstPlayer }));
  }

  loadState();
  turn = firstPlayer;

  function resizeCanvas(){
  const rect = canvas.getBoundingClientRect();
  const cssSize = Math.floor(Math.min(rect.width, rect.height));
  const dpr = window.devicePixelRatio || 1;

  // âœ… CSS í¬ê¸°ëŠ” ê±´ë“œë¦¬ì§€ ë§ê³ (= íë¦¼ ì›ì¸ ì œê±°)
  // âœ… ë‚´ë¶€ ë¹„íŠ¸ë§µ í•´ìƒë„ë§Œ DPRë¡œ ì˜¬ë¦¼
  canvas.width  = Math.floor(cssSize * dpr);
  canvas.height = Math.floor(cssSize * dpr);

  // âœ… ê·¸ë¦¬ê¸°ëŠ” CSS px ì¢Œí‘œê³„ë¡œ
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

  return cssSize;
}

  let CANVAS_SIZE = 0;
let margin = 0;
let gridSize = 0;
let cell = 0;
let r = 0;

function updateMetrics(){
  CANVAS_SIZE = resizeCanvas();
  margin = CANVAS_SIZE * 0.06;
  gridSize = CANVAS_SIZE - margin * 2;
  cell = gridSize / (SIZE - 1);
  r = cell * 0.48;
}

updateMetrics(); // âœ… ìµœì´ˆ 1íšŒ ê³„ì‚°

  const img1 = new Image(); img1.src = IMG_P1;
  const img2 = new Image(); img2.src = IMG_P2;
  img1.onload = () => { if(gameStarted) draw(); };
  img2.onload = () => { if(gameStarted) draw(); };

  function setTurnUI(){
    const label = (turn === PLAYER) ? "ì—¬ë´‰ì´ ì°¨ë¡€" : "ë©§ë´‰ì´ ìƒê°ì¤‘â€¦";
    turnChip.innerHTML = `<span class="dot"></span><span>${label}</span>`;
    toggleFirstBtn.textContent = `ì„ ê³µ: ${nameOf(firstPlayer)}`;
  }

  function pointerToCell(clientX, clientY){
  const rect = canvas.getBoundingClientRect();

  // í™”ë©´ ì¢Œí‘œ â†’ ìº”ë²„ìŠ¤ ì¢Œí‘œ
  const scaleX = canvas.width / rect.width;
  const scaleY = canvas.height / rect.height;

  const x = (clientX - rect.left) * scaleX;
  const y = (clientY - rect.top) * scaleY;

  // ë³´ë“œ ì˜ì—­ ë°– í„°ì¹˜ ë°©ì§€
  const min = margin - cell * 0.4;
  const max = margin + cell * (SIZE - 1) + cell * 0.4;

  if (x < min || x > max || y < min || y > max) {
    return null; // ğŸ‘‰ ë°”ê¹¥ í„°ì¹˜ ë¬´ì‹œ
  }

  // ê°€ì¥ ê°€ê¹Œìš´ êµì°¨ì ìœ¼ë¡œ ìŠ¤ëƒ…
  const gx = Math.round((x - margin) / cell);
  const gy = Math.round((y - margin) / cell);

  return {
    x: clamp(gx, 0, SIZE - 1),
    y: clamp(gy, 0, SIZE - 1)
  };
}

  function inRange(x,y){ return x>=0 && x<SIZE && y>=0 && y<SIZE; }
  function countDir(x,y,dx,dy,p){
    let c=0, nx=x+dx, ny=y+dy;
    while(inRange(nx,ny) && board[ny][nx]===p){ c++; nx+=dx; ny+=dy; }
    return c;
  }
  function isWin(x,y,p){
    const dirs = [[1,0],[0,1],[1,1],[1,-1]];
    for(const [dx,dy] of dirs){
      const line = 1 + countDir(x,y,dx,dy,p) + countDir(x,y,-dx,-dy,p);
      if(line >= WIN) return true;
    }
    return false;
  }
  function isDraw(){
    for(let y=0;y<SIZE;y++) for(let x=0;x<SIZE;x++) if(board[y][x]===0) return false;
    return true;
  }

  function drawGrid(){
    const W = CANVAS_SIZE;
    const H = CANVAS_SIZE;
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle = "rgba(255,255,255,.92)";
    ctx.fillRect(0,0,W,H);

    ctx.lineWidth = 1;
    ctx.strokeStyle = "rgba(0,0,0,.12)";
    for(let i=0;i<SIZE;i++){
      const px = margin + i*cell;
      const py = margin + i*cell;
      ctx.beginPath(); ctx.moveTo(px, margin); ctx.lineTo(px, margin+(SIZE-1)*cell); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(margin, py); ctx.lineTo(margin+(SIZE-1)*cell, py); ctx.stroke();
    }

    const stars = [
      {x:3,y:3},{x:11,y:3},{x:7,y:7},{x:3,y:11},{x:11,y:11}
    ];
    ctx.fillStyle = "rgba(0,0,0,.22)";
    for(const s of stars){
      ctx.beginPath();
      ctx.arc(margin + s.x*cell, margin + s.y*cell, 3.6, 0, Math.PI*2);
      ctx.fill();
    }
  }

  function drawFallbackStone(cx, cy, rr, player){
    ctx.beginPath();
    ctx.arc(cx, cy, rr, 0, Math.PI*2);
    ctx.fillStyle = (player === PLAYER) ? "#ffffff" : "#0b0f19";
    ctx.fill();
    ctx.lineWidth = 2;
    ctx.strokeStyle = (player === PLAYER) ? "rgba(0,0,0,.35)" : "rgba(255,255,255,.35)";
    ctx.stroke();

    ctx.beginPath();
    ctx.arc(cx - rr*0.22, cy - rr*0.22, rr*0.28, 0, Math.PI*2);
    ctx.fillStyle = "rgba(255,255,255,.20)";
    ctx.fill();
  }

  function drawStone(x, y, p, isLast){
  const img = (p === PLAYER) ? img1 : img2;
  const cx = margin + x * cell;
  const cy = margin + y * cell;

  const canUseImage = img && img.complete && (img.naturalWidth > 0 || img.width > 0);

  if (canUseImage){
    // 1) ë°°ê²½ ì›
    ctx.beginPath();
    ctx.arc(cx, cy, r, 0, Math.PI * 2);
    ctx.fillStyle = (p === PLAYER) ? "#ffffff" : "#0b0f19";
    ctx.fill();

    // 2) ì›í˜• í´ë¦½ + ì´ë¯¸ì§€(contain)
    ctx.save();
    ctx.beginPath();
    ctx.arc(cx, cy, r, 0, Math.PI * 2);
    ctx.clip();

    const inner = r * 0.78;
    const iw = img.naturalWidth || img.width;
    const ih = img.naturalHeight || img.height;

    const box = inner * 2;
    const scale = Math.min(box / iw, box / ih);

    const dw = iw * scale;
    const dh = ih * scale;

    // ë¨¸ë¦¬ ìœ„ ì§¤ë¦¼ ë°©ì§€(ì‚´ì§ ì•„ë˜ë¡œ)
    const yOffset = r * 0.06;
    ctx.drawImage(img, cx - dw/2, cy - dh/2 + yOffset, dw, dh);

    ctx.restore();

    // 3) ë§(í…Œë‘ë¦¬)
    const ring = Math.max(3, r * 0.14);
    ctx.lineWidth = ring;
    ctx.strokeStyle = (p === PLAYER) ? "#ffffff" : "#0b0f19";
    ctx.beginPath();
    ctx.arc(cx, cy, r - ring/2, 0, Math.PI * 2);
    ctx.stroke();
  } else {
    drawFallbackStone(cx, cy, r, p);
  }

  // ë§ˆì§€ë§‰ ìˆ˜ í‘œì‹œ
  ctx.lineWidth = isLast ? 4 : 2;
  const baseStroke = (p === PLAYER) ? "rgba(0,0,0,.22)" : "rgba(255,255,255,.22)";
  const lastStroke = (p === PLAYER) ? "rgba(0,0,0,.70)" : "rgba(255,255,255,.70)";
  ctx.strokeStyle = isLast ? lastStroke : baseStroke;
  ctx.beginPath();
  ctx.arc(cx, cy, r, 0, Math.PI * 2);
  ctx.stroke();
}
    
  function draw(){
    drawGrid();
    for(let y=0;y<SIZE;y++){
      for(let x=0;x<SIZE;x++){
        const v = board[y][x];
        if(!v) continue;
        const isLast = lastMove && lastMove.x===x && lastMove.y===y;
        drawStone(x,y,v,isLast);
      }
    }
  }

  function getWinRate(){
    const w = results.filter(r => r==="W").length;
    return results.length ? (w / results.length) : null;
  }
  function adjustDifficulty(){
    const wr = getWinRate();
    if(wr === null) return;
    const error = TARGET_WIN_RATE - wr;
    difficulty -= error * 0.18;
    difficulty = clamp(difficulty, AI_MIN, AI_MAX);
  }
  function getMistakeRate(){
    const t = 1 - difficulty;
    return clamp(0.02 + t * 0.22, 0.02, 0.18);
  }

  function genCandidates(){
    const cand = [];
    let hasStone = false;
    const mark = Array.from({length: SIZE}, () => Array(SIZE).fill(false));

    for(let y=0;y<SIZE;y++){
      for(let x=0;x<SIZE;x++){
        if(board[y][x] !== 0){
          hasStone = true;
          for(let dy=-2; dy<=2; dy++){
            for(let dx=-2; dx<=2; dx++){
              const nx=x+dx, ny=y+dy;
              if(inRange(nx,ny) && board[ny][nx]===0) mark[ny][nx] = true;
            }
          }
        }
      }
    }
    if(!hasStone){
      const c = Math.floor(SIZE/2);
      return [
        {x:c,y:c},{x:c-1,y:c},{x:c+1,y:c},{x:c,y:c-1},{x:c,y:c+1}
      ].filter(m => inRange(m.x,m.y));
    }
    for(let y=0;y<SIZE;y++) for(let x=0;x<SIZE;x++) if(mark[y][x]) cand.push({x,y});
    return cand;
  }

  function maxLineIfPlace(x,y,p){
    const dirs = [[1,0],[0,1],[1,1],[1,-1]];
    let best = 1;
    for(const [dx,dy] of dirs){
      const line = 1 + countDir(x,y,dx,dy,p) + countDir(x,y,-dx,-dy,p);
      if(line > best) best = line;
    }
    return best;
  }

  function playerHasImmediateWinAfterAI(){
    const cand = genCandidates();
    for(const m of cand){
      board[m.y][m.x] = PLAYER;
      const win = isWin(m.x, m.y, PLAYER);
      board[m.y][m.x] = 0;
      if(win) return true;
    }
    return false;
  }

  function scoreMove(x,y){
    const aiLine = maxLineIfPlace(x,y,AI);
    const plLine = maxLineIfPlace(x,y,PLAYER);

    const c = (SIZE-1)/2;
    const dist = Math.abs(x-c) + Math.abs(y-c);
    const centerScore = (SIZE*2 - dist);

    let score = 0;

    if(aiLine >= 5) score += 200000;
    else if(aiLine === 4) score += 9000;
    else if(aiLine === 3) score += 1400;
    else if(aiLine === 2) score += 180;

    if(plLine >= 5) score += 180000;
    else if(plLine === 4) score += 12000;
    else if(plLine === 3) score += 1600;
    else if(plLine === 2) score += 140;

    score += centerScore * 4;

    if(lastMove){
      const dx = Math.abs(x - lastMove.x);
      const dy = Math.abs(y - lastMove.y);
      const near = Math.max(0, 7 - (dx+dy));
      score += near * 10;
    }

    return score;
  }

  function findForcedMove(p){
    const cand = genCandidates();
    for(const m of cand){
      board[m.y][m.x] = p;
      const win = isWin(m.x, m.y, p);
      board[m.y][m.x] = 0;
      if(win) return m;
    }
    return null;
  }

  function rankMoves(){
    const cand = genCandidates();
    const ranked = cand.map(m => ({...m, score: scoreMove(m.x,m.y)}));
    ranked.sort((a,b) => b.score - a.score);
    return ranked;
  }

  function chooseAIMove(){
    const winMove = findForcedMove(AI);
if(winMove && !isDoubleThreeMoveFor(AI, winMove.x, winMove.y)) return winMove;

const blockMove = findForcedMove(PLAYER);
if(blockMove && !isDoubleThreeMoveFor(AI, blockMove.x, blockMove.y)) return blockMove;

    const ranked = rankMoves();
    if(!ranked.length) return null;

    const filtered = [];
    for(const m of ranked.slice(0, Math.min(18, ranked.length))){
  // âœ… 33ì´ë©´ í›„ë³´ ì œì™¸ (ë‘ê¸° ì „ì— ê²€ì‚¬)
  if(isDoubleThreeMoveFor(AI, m.x, m.y)) continue;

  board[m.y][m.x] = AI;
  const bad = playerHasImmediateWinAfterAI();
  board[m.y][m.x] = 0;

  filtered.push({x:m.x, y:m.y, score: m.score - (bad ? 50000 : 0)});
}
    filtered.sort((a,b) => b.score - a.score);

   if(!filtered.length){
  const safe = ranked.find(m => !isDoubleThreeMoveFor(AI, m.x, m.y));
  return safe || ranked[0];
}

   const doMistake = Math.random() < getMistakeRate();
   if(!doMistake) return { x: filtered[0].x, y: filtered[0].y };

    const widen = Math.floor((1 - difficulty) * MAX_SOFT_CHOICE);
    const maxIdx = clamp(1 + widen, 1, Math.min(MAX_SOFT_CHOICE, filtered.length)) - 1;
    const pick = Math.floor(Math.random() * (maxIdx + 1));
    return { x: filtered[pick].x, y: filtered[pick].y };
  }

    // =========================
  // âœ… 33(ë”ë¸” ì“°ë¦¬) íŒì • (ì—¬ë´‰/ë©§ë´‰ ê³µìš©)
  // who(PLAYER ë˜ëŠ” AI)ê°€ (x,y)ì— ë‘ë©´ 33ì´ë©´ true
  // =========================
  function cellToCharFor(who, x, y){
    if(!inRange(x,y)) return "2"; // ë°”ê¹¥=ë§‰í˜
    const v = board[y][x];
    if(v === 0) return "0";       // ë¹ˆì¹¸
    if(v === who) return "1";     // ë‚´ ëŒ
    return "2";                   // ìƒëŒ€ ëŒ=ë§‰í˜
  }

  function hasOpenThreeInDirFor(who, cx, cy, dx, dy){
    const line = [];
    for(let k=-4;k<=4;k++){
      line.push(cellToCharFor(who, cx + k*dx, cy + k*dy));
    }
    const center = 4;

    const p5 = [["0","1","1","1","0"]];
    const p6 = [
      ["0","1","1","0","1","0"],
      ["0","1","0","1","1","0"]
    ];

    function matchAt(arr, pat, start){
      for(let i=0;i<pat.length;i++){
        if(arr[start+i] !== pat[i]) return false;
      }
      return true;
    }

    // 5ì¹¸ ì°½: 0 111 0
    for(let s=0; s<=line.length-5; s++){
      if(center < s || center > s+4) continue;
      if(matchAt(line, p5[0], s)){
        const left = (s-1>=0) ? line[s-1] : "2";
        const right = (s+5<line.length) ? line[s+5] : "2";
        if(!(left==="1" || right==="1")) return true; // 4ì—°ì† ì°©ì‹œ ë°°ì œ
      }
    }

    // 6ì¹¸ ì°½: ì í”„3
    for(let s=0; s<=line.length-6; s++){
      if(center < s || center > s+5) continue;
      for(const pat of p6){
        if(matchAt(line, pat, s)) return true;
      }
    }
    return false;
  }

  function isDoubleThreeMoveFor(who, x, y){
    if(board[y][x] !== 0) return false;

    board[y][x] = who; // ì„ì‹œ ì°©ìˆ˜
    const dirs = [[1,0],[0,1],[1,1],[1,-1]];
    let cnt = 0;
    for(const [dx,dy] of dirs){
      if(hasOpenThreeInDirFor(who, x, y, dx, dy)) cnt++;
    }
    board[y][x] = 0; // ì›ë³µ
    return cnt >= 2;
  }
  // =========================
  // ê²Œì„ ì¢…ë£Œ ì²˜ë¦¬
  // =========================
  function endGame(type){
    gameOver = true;

    if(type === "win") results.push("W");
    else if(type === "lose") results.push("L");
    results = results.slice(-10);
    adjustDifficulty();
    saveState();

    if(type === "win") openModal("ìŠ¹ë¦¬! ğŸ‰", "ë©§ë´‰ì´ ìš¸ê³  ê°â€¦ ë‹¤ì‹œ í•œ íŒ?");
    else if(type === "lose") openModal("íŒ¨ë°°! ğŸ˜µ", "ì´ë²ˆ ë©§ë´‰ì´ ì¢€ ë¹¡ì…Œì§€â€¦ ë‹¤ì‹œ ê°€ì!");
    else openModal("ë¬´ìŠ¹ë¶€! ğŸ¤", "íŒ½íŒ½í–ˆë‹¤â€¦ ë‹¤ì‹œ ê°€ì!");
  }

  function place(x,y,who){
    if(gameOver) return false;
    if(board[y][x] !== 0) return false;

    board[y][x] = who;
    lastMove = { x, y, player: who };
    draw();

    if(isWin(x,y,who)){
      setMsg(`${nameOf(who)} ìŠ¹ë¦¬!`);
      endGame(who === PLAYER ? "win" : "lose");
      return true;
    }
    if(isDraw()){
      setMsg("ë¬´ìŠ¹ë¶€!");
      endGame("draw");
      return true;
    }
    return true;
  }

  function nextTurn(){
    turn = (turn === PLAYER) ? AI : PLAYER;
    setTurnUI();

    if(gameOver) return;

    if(turn === AI){
      setMsg("ë©§ë´‰ì´â€¦");
      setTimeout(() => {
        if(gameOver) return;
        const m = chooseAIMove();
        if(!m){
          openModal("ì˜¤ë¥˜!", "AIê°€ ë‘˜ ê³³ì„ ëª» ì°¾ì•˜ì–´. ë‹¤ì‹œí•˜ê¸° ëˆŒëŸ¬ì¤˜!");
          gameOver = true;
          return;
        }
        place(m.x, m.y, AI);
        if(!gameOver){
          turn = PLAYER;
          setTurnUI();
          setMsg("ì—¬ë´‰ì´ ì°¨ë¡€!");
        }
      }, AI_DELAY);
    }else{
      setMsg("ì—¬ë´‰ì´ ì°¨ë¡€!");
    }
  }

  function resetBoard(){
    closeModal();

    board = Array.from({ length: SIZE }, () => Array(SIZE).fill(0));
    gameOver = false;
    lastMove = null;
    turn = firstPlayer;
    setTurnUI();
    saveState();
    draw();

    if(turn === AI){
      setMsg("ë©§ë´‰ì´ ì„ ê³µ!");
      setTimeout(() => {
        const m = chooseAIMove();
        if(m){
          place(m.x, m.y, AI);
          if(!gameOver){
            turn = PLAYER;
            setTurnUI();
            setMsg("ì—¬ë´‰ì´ ì°¨ë¡€!");
          }
        }
      }, AI_DELAY);
    }else{
      setMsg("ì›í•˜ëŠ” ê³³ì„ ëˆŒëŸ¬ ëŒì„ ë‘¬!");
    }
  }

  // =========================
  // ì…ë ¥
  // =========================
  canvas.addEventListener("pointerdown", (e) => {
    e.preventDefault();
    if(!gameStarted) return;
    if(gameOver) return;
    if(turn !== PLAYER) return;

  const pos = pointerToCell(e.clientX, e.clientY);
   if (!pos) return;   // âœ… ë³´ë“œ ë°– í„°ì¹˜ ë¬´ì‹œ

   const { x, y } = pos;

    // âœ… 33ì´ë©´ ë§‰ê¸° + 1.5ì´ˆ í† ìŠ¤íŠ¸
   if(isDoubleThreeMoveFor(PLAYER, x, y)){
      showToast33("33ì€ ì•ˆë¼!", 1500);
      setMsg("33ì€ ê¸ˆì§€ì•¼!");
      return;
    }

    const ok = place(x,y,PLAYER);
    if(!ok) return;
    if(!gameOver) nextTurn();
  }, { passive:false });

  canvas.addEventListener("contextmenu", (e) => e.preventDefault());

  resetBtn.addEventListener("click", () => resetBoard());
  toggleFirstBtn.addEventListener("click", () => {
    firstPlayer = (firstPlayer === PLAYER) ? AI : PLAYER;
    saveState();
    resetBoard();
  });

  modalRestartBtn.addEventListener("click", () => resetBoard());
  modalCloseBtn.addEventListener("click", () => closeModal());

  // start modal selection
  let startFirst = "PLAYER";
  startChoices.addEventListener("click", (e) => {
    const item = e.target.closest(".choice");
    if(!item) return;
    startFirst = item.dataset.first === "AI" ? "AI" : "PLAYER";
    startChoices.querySelectorAll(".choice").forEach(el => el.classList.remove("active"));
    item.classList.add("active");
  });

  startBtn.addEventListener("click", () => {
    firstPlayer = (startFirst === "AI") ? AI : PLAYER;
    saveState();
    gameStarted = true;
    setControlsEnabled(true);
    closeStartModal();
    resetBoard();
  });

  // init
  gameStarted = false;
  setControlsEnabled(false);
  setTurnUI();
  drawGrid();
  setMsg("ì„ ê³µì„ ì„ íƒí•˜ê³  ì‹œì‘í•˜ê¸° ëˆŒëŸ¬ì¤˜!");
  openStartModal();

   /* âœ… í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ ìº”ë²„ìŠ¤ ì¬ê³„ì‚° */
  window.addEventListener("resize", () => {
  updateMetrics();
  draw();
});
  
})();
</script>
</body>
</html>
