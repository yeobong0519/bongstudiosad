<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ë©§ë´‰ì´ë¥¼ í”¼í•´ë¼! | ë´‰ ìŠ¤íŠœë””ì˜¤ ë¯¸ë‹ˆê²Œì„</title>

  <meta name="description" content="ì„¤ì¹˜ ì—†ì´ ë°”ë¡œ ì¦ê¸°ëŠ” ë¸Œë¼ìš°ì € ë¯¸ë‹ˆê²Œì„! ì—¬ë´‰ì´ë¥¼ ì¢Œìš°ë¡œ ì›€ì§ì—¬ ìœ„ì—ì„œ ë–¨ì–´ì§€ëŠ” ë©§ë´‰ì´ë¥¼ í”¼í•˜ê³  ìµœê³  ì ìˆ˜ì— ë„ì „í•˜ì„¸ìš”." />
  <link rel="canonical" href="https://bongstudiosad.com/games/metbong-dodge/" />

  <!-- âœ… ê³µí†µ CSS/JS (ë„¤ë¹„/í‘¸í„° ìë™ ë¡œë“œìš©) -->
  <link rel="stylesheet" href="/common/common.css" />
  <script defer src="/common/common.js"></script>

  <!-- Google AdSense (client ìœ ì§€) -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2371351351559028"
    crossorigin="anonymous"></script>

  <!-- âœ… (ìŠ¹ì¸ìš©) êµ¬ì¡°í™” ë°ì´í„° -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "ë©§ë´‰ì´ë¥¼ í”¼í•´ë¼! (Metbong Dodge)",
    "operatingSystem": "Web Browser",
    "applicationCategory": "GameApplication",
    "genre": "Action, Avoidance",
    "description": "ë´‰ ìŠ¤íŠœë””ì˜¤ì˜ ìºë¦­í„° ì—¬ë´‰ì´ë¥¼ ì¡°ì‘í•˜ì—¬ ë–¨ì–´ì§€ëŠ” ë©§ë´‰ì´ë¥¼ í”¼í•˜ëŠ” ë¸Œë¼ìš°ì € ê¸°ë°˜ ì•¡ì…˜ ë¯¸ë‹ˆê²Œì„ì…ë‹ˆë‹¤.",
    "offers": { "@type": "Offer", "price": "0", "priceCurrency": "KRW" },
    "publisher": { "@type": "Organization", "name": "ë´‰ ìŠ¤íŠœë””ì˜¤" }
  }
  </script>

  <style>
    :root{
      --line: rgba(0,0,0,.10);
      --text: rgba(0,0,0,.88);
      --muted: rgba(0,0,0,.60);
      --card: #ffffff;
      --bg: #f6f7fb;
      --accent: #ff6b81;
      --ok: #0ea5e9;

      /* âœ… ê²Œì„ ë³´ë“œ ì„¸ë¡œ ìŠ¤ì¼€ì¼ (ê¸°ì¡´ play.html ì„¤ì • ìœ ì§€) */
      --boardScale: 0.75;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:var(--bg);
      color:var(--text);
      min-height:100vh;
      overscroll-behavior:none;
      touch-action:manipulation;
    }
    main.page{ padding: 10px 12px 22px; }
    .wrap{
      width:min(520px, 100%);
      margin:0 auto;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .hero{
      border:1px solid var(--line);
      background:var(--card);
      border-radius:22px;
      padding:16px 16px;
      box-shadow: 0 18px 55px rgba(0,0,0,.10);
      overflow:hidden;
      position:relative;
    }
    .hero::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(520px 220px at 10% 0%, rgba(255,107,129,.18), transparent 60%),
        radial-gradient(520px 220px at 90% 10%, rgba(14,165,233,.14), transparent 55%);
      pointer-events:none;
    }
    .hero > *{ position:relative; }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      background: rgba(255,107,129,.14);
      border:1px solid rgba(255,107,129,.22);
      color:#b91c1c;
      padding:6px 10px;
      border-radius:999px;
      font-weight:900;
      font-size:12px;
      letter-spacing:-.2px;
      width: fit-content;
    }
    .hero h1{
      margin:10px 0 6px;
      font-size:22px;
      letter-spacing:-.4px;
      line-height:1.15;
    }
    .hero p{
      margin:6px 0 0;
      color:var(--muted);
      line-height:1.6;
      font-size:13px;
      font-weight:700;
    }

    .poster{
      margin-top:12px;
      border-radius:18px;
      background: #fff;
      border:1px solid var(--line);
      overflow:hidden;
    }
    .poster .img{
      width:100%;
      aspect-ratio: 16/10;
      background: #fff;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .poster .img img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .poster .meta{
      padding:12px 12px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .poster .meta .small{
      font-size:12px;
      color:var(--muted);
      font-weight:800;
    }

    .btn{
      appearance:none;
      border:none;
      background:var(--accent);
      color:#fff;
      padding:13px 14px;
      border-radius:999px;
      font-weight:1000;
      cursor:pointer;
      width:100%;
      letter-spacing:-.2px;
      box-shadow: 0 10px 26px rgba(255,107,129,.28);
    }
    .btn:active{ transform: scale(.99); }
    .btn.secondary{
      background:#eceef3;
      color:#111;
      box-shadow:none;
      font-weight:900;
    }

    .card{
      border:1px solid var(--line);
      background:var(--card);
      border-radius:20px;
      padding:14px 14px;
      box-shadow: 0 12px 34px rgba(0,0,0,.08);
      line-height:1.75;
      color: rgba(0,0,0,.75);
    }
    .card h2{
      margin:0 0 10px;
      font-size:16px;
      color: rgba(0,0,0,.92);
      letter-spacing:-.2px;
      font-weight:1000;
    }
    .card h3{
      margin:14px 0 6px;
      font-size:13px;
      color: rgba(0,0,0,.88);
      font-weight:1000;
    }
    .card p{
      margin:8px 0 0;
      font-size:13px;
      color: rgba(0,0,0,.70);
      font-weight:700;
    }
    .card ul{
      margin:8px 0 0;
      padding-left:18px;
      font-size:13px;
      color: rgba(0,0,0,.70);
      font-weight:700;
      line-height:1.7;
    }
    .card li{ margin:4px 0; }

    .disclosure{ border-left:5px solid var(--accent); }

    .inline-links{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      color:#111;
      text-decoration:none;
      font-weight:900;
      font-size:13px;
      flex:1;
      min-width: 150px;
      text-align:center;
    }

    /* =========================
       âœ… (ì „ëµ A) ì¸í˜ì´ì§€ ê²Œì„ ì˜ì—­
       ========================= */

    .play-card{ padding: 14px 14px; }
    .play-head{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .play-head .sub{
      margin:0;
      font-size:12.5px;
      color:var(--muted);
      font-weight:800;
      line-height:1.55;
    }

    /* ìš´ì˜ ì•ˆë‚´(ê¸°ì¡´ "ê´‘ê³ ìë¦¬" ëŠë‚Œ ì œê±°) */
    .notice-slot{
      width:100%;
      border:1px solid rgba(0,0,0,.10);
      border-radius:18px;
      padding:12px 12px;
      background: rgba(255,255,255,.65);
      color: rgba(0,0,0,.62);
      font-size:12px;
      font-weight:800;
      line-height:1.5;
    }
    .notice-slot .title{
      font-size:12px;
      font-weight:1000;
      color: rgba(0,0,0,.78);
      margin-bottom:6px;
    }

    .board{
      position:relative;
      width:100%;
      border-radius:22px;
      overflow:hidden;
      border:1px solid var(--line);
      background:#fff;
      box-shadow: 0 18px 55px rgba(0,0,0,.12);
      touch-action:none;
      user-select:none;
      -webkit-user-select:none;
      -webkit-touch-callout:none;
      height: 620px; /* JSì—ì„œ ì¬ê³„ì‚° */
    }
    canvas{
      width:100%;
      height:100%;
      display:block;
      touch-action:none;
      user-select:none;
      -webkit-user-select:none;
      -webkit-touch-callout:none;
    }
    .hud{
      position:absolute;
      inset:14px 16px auto 16px;
      display:flex;
      gap:10px;
      justify-content:space-between;
      align-items:flex-start;
      pointer-events:none;
      z-index: 5;
    }
    .hud .box{
      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.72);
      backdrop-filter: blur(6px);
      min-width:0;
      flex:1;
      width:0;
    }
    .hud .k{
      font-size:12px;
      color:rgba(0,0,0,.55);
      font-weight:800;
      letter-spacing:-0.01em;
    }
    .hud .v{
      font-size:18px;
      font-weight:1000;
      margin-top:4px;
      color: var(--text);
    }

    .overlay{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      background: rgba(0,0,0,.42);
      backdrop-filter: blur(6px);
      z-index: 10;
    }
    .modal{
      width:min(420px, 100%);
      border-radius:22px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.70);
      box-shadow: 0 22px 70px rgba(0,0,0,.25);
      padding:18px;
      text-align:center;
      color: var(--text);
    }
    .modal h2{ margin:6px 0 8px; font-size:20px; letter-spacing:-0.02em; }
    .modal p{ margin:0 0 14px; color:rgba(0,0,0,.55); line-height:1.45; font-size:13px; font-weight:800; }

    .btns{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .gamebtn{
      appearance:none;
      border:1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.85);
      color: var(--text);
      padding:11px 14px;
      border-radius:14px;
      font-weight:900;
      cursor:pointer;
      min-width:140px;
    }
    .gamebtn.primary{
      border-color: rgba(255,107,129,.40);
      background: rgba(255,107,129,.16);
    }

    .footerhint{
      margin-top:8px;
      font-size:12px;
      color:rgba(0,0,0,.55);
      text-align:center;
      font-weight:800;
    }

    .bot-text{
      border:1px solid rgba(0,0,0,.10);
      border-radius:18px;
      padding:12px 12px;
      background:#fff;
      line-height:1.7;
      color: rgba(0,0,0,.72);
      font-size:12.5px;
      font-weight:700;
    }
    .bot-text b{ color: rgba(0,0,0,.90); font-weight:1000; }
    .bot-text a{ color:#111; font-weight:1000; text-decoration:none; }

    @media (max-width: 420px){
      .hud{ inset:12px 12px auto 12px; gap:8px; }
      .hud .box{ padding:8px 10px; border-radius:14px; }
      .hud .k{ font-size:11px; }
      .hud .v{ font-size:16px; }
    }
  </style>
</head>

<body>
  <div id="nav-mount"></div>

  <main class="page">
    <div class="wrap">

      <!-- ì†Œê°œ -->
      <section class="hero">
        <div class="badge">ğŸ® ë¯¸ë‹ˆê²Œì„ Â· ë¸Œë¼ìš°ì € ì¦‰ì‹œ í”Œë ˆì´</div>
        <h1>ë©§ë´‰ì´ë¥¼ í”¼í•´ë¼!</h1>
        <p>
          ë°”ë‹¥ì˜ ì—¬ë´‰ì´ë¥¼ ì¢Œìš°ë¡œ ì›€ì§ì—¬, ìœ„ì—ì„œ ë–¨ì–´ì§€ëŠ” ë©§ë´‰ì´ë¥¼ í”¼í•˜ëŠ” <b>í•˜ì´í¼ ìºì£¼ì–¼ ìƒì¡´ ê²Œì„</b>ì´ì•¼.
          ì„¤ì¹˜ ì—†ì´ ë°”ë¡œ ì‹¤í–‰ë˜ê³ , ëª¨ë°”ì¼Â·PC ëª¨ë‘ ì§€ì›í•´.
        </p>

        <div class="poster" aria-label="ê²Œì„ ë¯¸ë¦¬ë³´ê¸°">
          <div class="img">
            <img src="/img/og_default.png" alt="ë©§ë´‰ì´ë¥¼ í”¼í•´ë¼ ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€" />
          </div>
          <div class="meta">
            <div class="small">1ë¶„ ì»· Â· ë¬´í•œ ìƒì¡´ Â· BEST ê¸°ë¡ ì €ì¥</div>
            <button class="btn" onclick="document.getElementById('play').scrollIntoView({behavior:'smooth', block:'start'});">ë°”ë¡œ í”Œë ˆì´</button>
            <button class="btn secondary" onclick="document.getElementById('rules').scrollIntoView({behavior:'smooth', block:'start'});" style="margin-top:10px;">ê·œì¹™/íŒ ë³´ê¸° â†“</button>
          </div>
        </div>
      </section>

      <!-- âœ… (ì „ëµ A) ì¸í˜ì´ì§€ í”Œë ˆì´ -->
      <section class="card play-card" id="play" aria-label="ë©§ë´‰ì´ í”¼í•˜ê¸° í”Œë ˆì´ ì˜ì—­">
        <div class="play-head">
          <div>
            <h2 style="margin:0 0 6px;">ì§€ê¸ˆ ë°”ë¡œ í”Œë ˆì´</h2>
            <p class="sub" style="margin:0;">
              ëª¨ë°”ì¼ì€ <b>í„°ì¹˜ ë“œë˜ê·¸</b>, PCëŠ” <b>â† â†’</b> ë˜ëŠ” <b>A / D</b>ë¡œ ì¡°ì‘í•´.
              ë©§ë´‰ì´ì— ë‹¿ìœ¼ë©´ ê²Œì„ ì˜¤ë²„!
            </p>
          </div>
        </div>

        <div class="notice-slot" aria-label="ìš´ì˜ ì•ˆë‚´">
          <div class="title">ìš´ì˜ ì•ˆë‚´</div>
          <div>
            ì´ í˜ì´ì§€ì—ëŠ” ì„œë¹„ìŠ¤ ìš´ì˜ì„ ìœ„í•œ ê´‘ê³ /ê³µì§€ ë°°ë„ˆê°€ í‘œì‹œë  ìˆ˜ ìˆì–´.<br/>
            <b>ê²Œì„ í”Œë ˆì´ì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.</b>
          </div>
        </div>

        <div style="height:10px;"></div>

        <div class="board" id="board">
          <canvas id="c" aria-label="ë©§ë´‰ì´ í”¼í•˜ê¸° ê²Œì„ ìº”ë²„ìŠ¤"></canvas>

          <div class="hud">
            <div class="box">
              <div class="k">ì ìˆ˜</div>
              <div class="v" id="score">0</div>
            </div>

            <div class="box" style="text-align:center;">
              <div class="k">BEST</div>
              <div class="v" id="bestPill">0</div>
            </div>

            <div class="box" style="text-align:right;">
              <div class="k">ë ˆë²¨</div>
              <div class="v" id="level">1</div>
            </div>
          </div>

          <div class="overlay" id="overlay">
            <div class="modal">
              <div style="font-size:42px; line-height:1;">ğŸ«£</div>
              <h2 id="modalTitle">ë©§ë´‰ì´ í”¼í•˜ê¸°</h2>
              <p id="modalDesc">
                ë°”ë‹¥ì˜ ì—¬ë´‰ì´ë¥¼ ì¢Œìš°ë¡œ ì›€ì§ì—¬<br/>
                ìœ„ì—ì„œ ë–¨ì–´ì§€ëŠ” ë©§ë´‰ì´ ì–¼êµ´ì„ í”¼í•˜ì„¸ìš”!
              </p>
              <div class="btns">
                <button class="gamebtn primary" id="startBtn">ì‹œì‘í•˜ê¸°</button>
                <button class="gamebtn" id="howBtn">ì¡°ì‘ë°©ë²•</button>
              </div>
              <div style="margin-top:12px;font-size:12px;color:rgba(0,0,0,.55);font-weight:800;">
                ëª¨ë°”ì¼: ì—¬ë´‰ì´ë¥¼ í„°ì¹˜í•œ ì±„ ì¢Œìš° ë“œë˜ê·¸<br/>
                PC: â† â†’ ë˜ëŠ” A / D
              </div>
            </div>
          </div>
        </div>

        <div class="footerhint">BEST ê¸°ë¡ì„ ì„¸ì›Œë³´ì!</div>

        <section class="bot-text">
          <b>ê²Œì„ ìš”ì•½:</b> â€˜ë©§ë´‰ì´ë¥¼ í”¼í•´ë¼!â€™ëŠ” ë´‰ ìŠ¤íŠœë””ì˜¤ ìºë¦­í„° IP ê¸°ë°˜ì˜ ë¸Œë¼ìš°ì € ë¯¸ë‹ˆê²Œì„ì´ì•¼.<br/>
          <b>ë‚´ë¶€ ë§í¬:</b> <a href="/tests/">í…ŒìŠ¤íŠ¸ ì„¼í„°</a> Â· <a href="/">ë©”ì¸</a>
        </section>
      </section>

      <!-- ê·œì¹™/íŒ -->
      <section class="card" id="rules">
        <h2>ê²Œì„ ê·œì¹™ í•œ ì¥ ìš”ì•½</h2>
        <p>
          ê²Œì„ì€ ê°„ë‹¨í•´. í™”ë©´ ìœ„ì—ì„œ ë©§ë´‰ì´ê°€ ê³„ì† ë–¨ì–´ì§€ê³ , ì—¬ë´‰ì´ê°€ ë©§ë´‰ì´ì— ë‹¿ìœ¼ë©´ ê²Œì„ ì˜¤ë²„!
          ì˜¤ë˜ ë²„í‹¸ìˆ˜ë¡ ì ìˆ˜ì™€ ë ˆë²¨ì´ ì˜¤ë¥´ê³  ë‚™í•˜ ì†ë„Â·ë¹ˆë„ê°€ ì ì  ë¹¨ë¼ì ¸.
        </p>

        <h3>ì¡°ì‘ ë°©ë²•</h3>
        <ul>
          <li><b>ëª¨ë°”ì¼</b>: ì—¬ë´‰ì´ë¥¼ í„°ì¹˜í•œ ì±„ ì¢Œìš°ë¡œ ë“œë˜ê·¸</li>
          <li><b>PC</b>: í‚¤ë³´ë“œ <b>â† â†’</b> ë˜ëŠ” <b>A / D</b></li>
        </ul>

        <h3>ê³ ë“ì  íŒ</h3>
        <ul>
          <li><b>ì¤‘ì•™ì„ ì„ ì </b>í•´ ë‘ë©´ ë‹¤ìŒ ë‚™í•˜ ì§€ì ì— ëŒ€ì‘í•˜ê¸° ì‰½ë‹¤</li>
          <li>í° íšŒí”¼ë³´ë‹¤ <b>ì§§ì€ ë¯¸ì„¸ ì´ë™</b>ì´ ì ìˆ˜ ìœ ì§€ì— ìœ ë¦¬í•˜ë‹¤</li>
          <li>ë ˆë²¨ì´ ì˜¬ë¼ê°ˆìˆ˜ë¡ â€˜ì˜ˆì¸¡ â†’ ì„ ì´ë™â€™ì´ í•µì‹¬</li>
        </ul>
      </section>

      <!-- ê³ ì§€ -->
      <section class="card disclosure">
        <h2>ìš´ì˜/ê´‘ê³  ê³ ì§€</h2>
        <p>
          ì´ í˜ì´ì§€ì—ëŠ” ì„œë¹„ìŠ¤ ìš´ì˜ì„ ìœ„í•œ ê´‘ê³ ê°€ í¬í•¨ë  ìˆ˜ ìˆì–´.
          ì¼ë¶€ ì™¸ë¶€ ë§í¬ê°€ ì¡´ì¬í•  ê²½ìš° ì œíœ´(ì¶”ì²œ) ë§í¬ì¼ ìˆ˜ ìˆìœ¼ë©°, ë°œìƒí•œ ìˆ˜ìµì€ ì‚¬ì´íŠ¸ ìš´ì˜ì— ë„ì›€ì´ ë  ìˆ˜ ìˆì–´.
        </p>
      </section>

      <!-- ê¸°ìˆ  -->
      <section class="card">
        <h2>ê¸°ìˆ ì  íŠ¹ì§•</h2>
        <p>
          â€˜ë©§ë´‰ì´ë¥¼ í”¼í•´ë¼!â€™ëŠ” ë³„ë„ ê²Œì„ ì—”ì§„ ì—†ì´ <b>HTML5 Canvas</b>ì™€ <b>JavaScript</b>ë¡œ êµ¬í˜„í–ˆì–´.
          requestAnimationFrame ê¸°ë°˜ì˜ í”„ë ˆì„ ë£¨í”„ë¥¼ ì‚¬ìš©í•˜ê³ , ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒìœ¼ë¡œ ëª¨ë°”ì¼/ë°ìŠ¤í¬íƒ‘ì„ ëª¨ë‘ ì§€ì›í•´.
        </p>

        <div class="inline-links">
          <a class="pill" href="#play">í”Œë ˆì´ ì˜ì—­ìœ¼ë¡œ â†‘</a>
          <a class="pill" href="/tests/">í…ŒìŠ¤íŠ¸ ì„¼í„° â†’</a>
        </div>
      </section>

    </div>
  </main>

  <div id="footer-mount"></div>

<script>
(() => {
  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");

  const board = document.getElementById("board");
  const overlay = document.getElementById("overlay");
  const startBtn = document.getElementById("startBtn");
  const howBtn = document.getElementById("howBtn");
  const scoreEl = document.getElementById("score");
  const levelEl = document.getElementById("level");
  const bestPill = document.getElementById("bestPill");
  const modalTitle = document.getElementById("modalTitle");
  const modalDesc  = document.getElementById("modalDesc");

  const IMG_PLAYER = "/img/yeobong.png";
  const IMG_ENEMY  = "/img/metbong.png";

  let W = 0;
  let H = 0;
  let DPR = 1;

  const SCALE = parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--boardScale")) || 0.75;

  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

  function lockScroll(lock){
    document.documentElement.style.overflow = lock ? "hidden" : "";
    document.body.style.overflow = lock ? "hidden" : "";
    document.body.style.position = lock ? "fixed" : "";
    document.body.style.width = lock ? "100%" : "";
    document.body.style.touchAction = lock ? "none" : "";
  }

  function fitBoardAndCanvas(){
    const nav = document.getElementById("nav");
    const footer = document.getElementById("footer");

    const navH = nav ? nav.offsetHeight : 0;
    const footerH = footer ? footer.offsetHeight : 0;

    const safe = 26;
    const available = window.innerHeight - navH - footerH - safe;

    const targetH = clamp(Math.floor(available * SCALE), 430, 720);
    board.style.height = targetH + "px";

    const rect = board.getBoundingClientRect();

    DPR = Math.min(2, window.devicePixelRatio || 1);
    const cssW = Math.max(320, rect.width);
    const cssH = Math.max(420, rect.height);

    canvas.width  = Math.floor(cssW * DPR);
    canvas.height = Math.floor(cssH * DPR);

    ctx.setTransform(DPR, 0, 0, DPR, 0, 0);

    W = cssW;
    H = cssH;

    player.x = clamp(player.x || W/2, player.w/2 + 12, W - player.w/2 - 12);
    player.y = H - (player.h/2 + 20);
  }

  function stabilizeFit(){
    fitBoardAndCanvas();
    setTimeout(fitBoardAndCanvas, 90);
    setTimeout(fitBoardAndCanvas, 260);
    setTimeout(fitBoardAndCanvas, 800);
  }

  const BEST_KEY = "metbong_dodge_best";
  let bestScore = Number(localStorage.getItem(BEST_KEY) || 0);
  bestPill.textContent = String(bestScore);

  let running = false;
  let gameOver = false;
  let tPrev = 0;

  const player = { w: 72, h: 72, x: 0, y: 0, speed: 720, vx: 0 };
  const enemies = [];
  let spawnTimer = 0;

  const BASE_FALL = 360;
  const MAX_FALL  = 760;
  const BASE_SPAWN_EVERY = 0.85;
  const SPAWN_STEP = 0.05;
  const SPAWN_MAX  = 0.40;

  let spawnEvery = BASE_SPAWN_EVERY;
  let fallSpeed  = BASE_FALL;

  let score = 0;
  let level = 1;

  const keys = { left:false, right:false };

  const imgPlayer = new Image();
  const imgEnemy  = new Image();
  let playerImgReady = false;
  let enemyImgReady = false;

  imgPlayer.onload = () => { playerImgReady = true; };
  imgEnemy.onload  = () => { enemyImgReady = true; };
  imgPlayer.src = IMG_PLAYER;
  imgEnemy.src  = IMG_ENEMY;

  function resetGame(){
    enemies.length = 0;
    spawnTimer = 0;
    spawnEvery = BASE_SPAWN_EVERY;
    fallSpeed  = BASE_FALL;

    score = 0;
    level = 1;
    scoreEl.textContent = "0";
    levelEl.textContent = "1";

    player.vx = 0;

    fitBoardAndCanvas();
    gameOver = false;
  }

  function showOverlay(title, desc, startText="ì‹œì‘í•˜ê¸°"){
    modalTitle.textContent = title;
    modalDesc.innerHTML = desc;
    startBtn.textContent = startText;
    overlay.style.display = "flex";
    lockScroll(false);
  }
  function hideOverlay(){ overlay.style.display = "none"; }

  function updateDifficulty(){
    const newLevel = 1 + Math.floor(score / 220);
    if(newLevel !== level){
      level = newLevel;
      levelEl.textContent = String(level);

      const nextFall = BASE_FALL * Math.pow(1.08, level - 1);
      fallSpeed = Math.min(MAX_FALL, nextFall);

      const spawnBoost = Math.min(SPAWN_MAX, SPAWN_STEP * (level - 1));
      spawnEvery = BASE_SPAWN_EVERY * (1 - spawnBoost);
    }
  }

  function spawnEnemy(){
    const r = Math.random();
    let size;
    if (r < 0.65) size = 26 + Math.random() * 46;
    else if (r < 0.92) size = 64 + Math.random() * 44;
    else size = 108 + Math.random() * 40;

    const x = (size/2 + 12) + Math.random() * (W - (size + 24));

    enemies.push({
      x, y: -size,
      w: size, h: size,
      vy: fallSpeed * (0.95 + Math.random()*0.22),
      rot: (Math.random()*0.6 - 0.3)
    });
  }

  function hitCircle(ax, ay, ar, bx, by, br){
    const dx = ax - bx;
    const dy = ay - by;
    return (dx*dx + dy*dy) <= (ar + br) * (ar + br);
  }

  function drawBackground(){
    ctx.clearRect(0,0,W,H);
  }

  function roundRect(x,y,w,h,r){
    const rr = Math.min(r, w/2, h/2);
    ctx.beginPath();
    ctx.moveTo(x+rr, y);
    ctx.arcTo(x+w, y, x+w, y+h, rr);
    ctx.arcTo(x+w, y+h, x, y+h, rr);
    ctx.arcTo(x, y+h, x, y, rr);
    ctx.arcTo(x, y, x+w, y, rr);
    ctx.closePath();
  }

  function drawImageContain(img, dx, dy, dw, dh){
    const iw = img.naturalWidth || img.width;
    const ih = img.naturalHeight || img.height;
    if(!iw || !ih) return;

    const s = Math.min(dw/iw, dh/ih);
    const rw = iw * s;
    const rh = ih * s;
    const rx = dx + (dw - rw) / 2;
    const ry = dy + (dh - rh) / 2;
    ctx.drawImage(img, rx, ry, rw, rh);
  }

  function drawPlayer(){
    const x = player.x, y = player.y;

    ctx.save();
    ctx.globalAlpha = 0.18;
    ctx.beginPath();
    ctx.ellipse(x, y + player.h/2 - 6, 36, 10, 0, 0, Math.PI*2);
    ctx.fillStyle = "#000";
    ctx.fill();
    ctx.globalAlpha = 1;

    if(playerImgReady){
      drawImageContain(imgPlayer, x-player.w/2, y-player.h/2, player.w, player.h);
    }else{
      roundRect(x-player.w/2, y-player.h/2, player.w, player.h, 18);
      ctx.fillStyle = "rgba(0,0,0,0.06)";
      ctx.fill();
      ctx.strokeStyle = "rgba(0,0,0,0.10)";
      ctx.lineWidth = 2;
      ctx.stroke();
      ctx.font = "40px system-ui";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillStyle = "#111";
      ctx.fillText("ğŸ™‚", x, y+2);
    }
    ctx.restore();
  }

  function drawEnemy(e){
    ctx.save();
    ctx.translate(e.x, e.y);
    ctx.rotate(e.rot);

    if(enemyImgReady){
      ctx.drawImage(imgEnemy, -e.w/2, -e.h/2, e.w, e.h);
    }else{
      roundRect(-e.w/2, -e.h/2, e.w, e.h, 18);
      ctx.fillStyle = "rgba(255,77,109,0.18)";
      ctx.fill();
      ctx.strokeStyle = "rgba(255,77,109,0.35)";
      ctx.lineWidth = 2;
      ctx.stroke();
      ctx.font = "36px system-ui";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("ğŸ˜ˆ", 0, 4);
    }

    ctx.restore();
  }

  function loop(ts){
    if(!running) return;

    const t = ts/1000;
    const dt = Math.min(0.033, t - tPrev || 0.016);
    tPrev = t;

    const dir = (keys.left ? -1 : 0) + (keys.right ? 1 : 0);
    player.vx = dir * player.speed;

    player.x += player.vx * dt;
    player.x = clamp(player.x, player.w/2 + 12, W - player.w/2 - 12);

    spawnTimer += dt;
    while (spawnTimer >= spawnEvery) {
      spawnTimer -= spawnEvery;
      const burst = 1 + Math.min(3, level - 1);
      for (let i = 0; i < burst; i++) spawnEnemy();
    }

    for(let i=enemies.length-1; i>=0; i--){
      const e = enemies[i];
      e.y += e.vy * dt;

      if(e.y - e.h/2 > H + 60){
        enemies.splice(i,1);
        score += 10;
        scoreEl.textContent = String(score);
        updateDifficulty();
        continue;
      }

      const pCx = player.x;
      const pCy = player.y + player.h * 0.10;
      const eCx = e.x;
      const eCy = e.y;

      const pr = Math.min(player.w, player.h) * 0.32;
      const er = Math.min(e.w, e.h) * 0.34;

      if (hitCircle(pCx, pCy, pr, eCx, eCy, er)) {
        endGame();
        return;
      }
    }

    drawBackground();
    drawPlayer();
    enemies.forEach(drawEnemy);

    requestAnimationFrame(loop);
  }

  function endGame(){
    running = false;
    gameOver = true;
    lockScroll(false);

    if(score > bestScore){
      bestScore = score;
      localStorage.setItem(BEST_KEY, String(bestScore));
      bestPill.textContent = String(bestScore);
    }

    showOverlay(
      "ê²Œì„ ì˜¤ë²„!",
      `ì ìˆ˜ <b style="color:var(--ok);">${score}</b> / BEST <b>${bestScore}</b><br/><br/>ë‹¤ì‹œ ë„ì „í• ê¹Œìš”?`,
      "ë‹¤ì‹œí•˜ê¸°"
    );
  }

  function startGame(){
    fitBoardAndCanvas();

    resetGame();
    hideOverlay();
    lockScroll(true);
    running = true;
    tPrev = 0;
    requestAnimationFrame(loop);
  }

  window.addEventListener("keydown", (e) => {
    if(e.key === "ArrowLeft" || e.key.toLowerCase() === "a") keys.left = true;
    if(e.key === "ArrowRight"|| e.key.toLowerCase() === "d") keys.right = true;
    if(e.key === " " && !running) startGame();
  });
  window.addEventListener("keyup", (e) => {
    if(e.key === "ArrowLeft" || e.key.toLowerCase() === "a") keys.left = false;
    if(e.key === "ArrowRight"|| e.key.toLowerCase() === "d") keys.right = false;
  });

  let dragging = false;
  function getPos(ev){
    const rect = canvas.getBoundingClientRect();
    const sx = (ev.clientX - rect.left) / rect.width;
    const sy = (ev.clientY - rect.top) / rect.height;
    return { x: sx*W, y: sy*H };
  }

  board.addEventListener("pointerdown", (ev) => {
    if(overlay.style.display !== "none") return;
    const p = getPos(ev);

    const grabW = player.w * 1.9;
    const grabH = player.h * 1.9;

    if(Math.abs(p.x - player.x) < grabW && Math.abs(p.y - player.y) < grabH){
      dragging = true;
      board.setPointerCapture(ev.pointerId);
    }
  });

  board.addEventListener("pointermove", (ev) => {
    if(!dragging || !running) return;
    const p = getPos(ev);
    player.x = clamp(p.x, player.w/2 + 12, W - player.w/2 - 12);
  });

  board.addEventListener("pointerup", (ev) => {
    dragging = false;
    try{ board.releasePointerCapture(ev.pointerId); }catch(_){}
  });

  startBtn.addEventListener("click", () => startGame());

  howBtn.addEventListener("click", () => {
    showOverlay(
      "ì¡°ì‘ë°©ë²•",
      `PC: <b>â† â†’</b> ë˜ëŠ” <b>A / D</b><br/>ëª¨ë°”ì¼: ì—¬ë´‰ì´ë¥¼ <b>í„°ì¹˜í•œ ì±„ ì¢Œìš° ë“œë˜ê·¸</b><br/><br/>ë©§ë´‰ì´ ì–¼êµ´ì— ë‹¿ìœ¼ë©´ ê²Œì„ ì˜¤ë²„!`,
      gameOver ? "ë‹¤ì‹œí•˜ê¸°" : "ì‹œì‘í•˜ê¸°"
    );
  });

  showOverlay(
    "ë©§ë´‰ì´ í”¼í•˜ê¸°",
    "ë°”ë‹¥ì˜ ì—¬ë´‰ì´ë¥¼ ì¢Œìš°ë¡œ ì›€ì§ì—¬<br/>ìœ„ì—ì„œ ë–¨ì–´ì§€ëŠ” ë©§ë´‰ì´ ì–¼êµ´ì„ í”¼í•˜ì„¸ìš”!",
    "ì‹œì‘í•˜ê¸°"
  );

  document.addEventListener("DOMContentLoaded", () => {
    stabilizeFit();
  });
  window.addEventListener("resize", stabilizeFit);
  window.addEventListener("orientationchange", () => setTimeout(stabilizeFit, 220));
})();
</script>

</body>
</html>
