<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ë©§ë´‰ì´ í”¼í•˜ê¸°</title>

  <!-- âœ… ê³µí†µ CSS/JS (ë„¤ë¹„/í‘¸í„° ìë™ ë¡œë“œìš©) -->
  <link rel="stylesheet" href="/common/common.css" />
  <script defer src="/common/common.js"></script>

  <style>
    :root{
      --bg1:#0b0f19;
      --bg2:#111a33;
      --card:rgba(255,255,255,.08);
      --line:rgba(255,255,255,.14);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.65);
      --danger:#ff4d6d;
      --ok:#6ee7ff;
    }
    *{ box-sizing:border-box; }
    body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:#fff;
  color:#111;
  min-height:100vh;
  padding:0;
}

    /* âœ… nav/footer ì•„ë˜ì— ê²Œì„ì´ ë“¤ì–´ê°€ë„ë¡ */
    .page{
      padding:18px;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .wrap{ width:min(520px, 100%); }
    .topbar{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:12px;
    }
    .title{
      font-weight:900;
      letter-spacing:-0.02em;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .pill{
      font-size:12px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--muted);
      white-space:nowrap;
    }

    .board{
      position:relative;
      width:100%;
      aspect-ratio: 9/16;
      border-radius:22px;
      overflow:hidden;
      border:1px solid var(--line);

     background:#fff;

      /* âœ… bg.pngê°€ ì•„ì§ ì—†ìœ¼ë©´ ìœ„ 3ì¤„ ì§€ìš°ê³  ì•„ë˜ ë°°ê²½ ì“°ë©´ ë¨
      background:
        radial-gradient(700px 400px at 50% 10%, rgba(110,231,255,.14), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      */

      box-shadow: 0 18px 55px rgba(0,0,0,.35);
      touch-action:none;
    }
    canvas{ width:100%; height:100%; display:block; }

    .hud{
      position:absolute;
      inset:12px 12px auto 12px;
      display:flex;
      gap:10px;
      justify-content:space-between;
      align-items:flex-start;
      pointer-events:none;
    }
    .hud .box{
      padding:10px 12px;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      backdrop-filter: blur(6px);
      min-width:140px;
    }
    .hud .k{
      font-size:12px;
      color:var(--muted);
      font-weight:800;
      letter-spacing:-0.01em;
    }
    .hud .v{
      font-size:18px;
      font-weight:1000;
      margin-top:4px;
    }

    .overlay{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      background: rgba(0,0,0,.42);
      backdrop-filter: blur(6px);
    }
    .modal{
      width:min(420px, 100%);
      border-radius:22px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.05));
      box-shadow: 0 22px 70px rgba(0,0,0,.45);
      padding:18px;
      text-align:center;
    }
    .modal h2{
      margin:6px 0 8px;
      font-size:20px;
      letter-spacing:-0.02em;
    }
    .modal p{
      margin:0 0 14px;
      color:var(--muted);
      line-height:1.45;
      font-size:13px;
    }
    .btns{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:10px;
    }
    button{
      appearance:none;
      border:1px solid var(--line);
      background:rgba(255,255,255,.10);
      color:var(--text);
      padding:11px 14px;
      border-radius:14px;
      font-weight:900;
      cursor:pointer;
      min-width:140px;
    }
    button.primary{
      border-color: rgba(110,231,255,.32);
      background: rgba(110,231,255,.18);
    }
    .hint{
      margin-top:12px;
      font-size:12px;
      color:var(--muted);
    }
    .footerhint{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      text-align:center;
    }
  </style>
</head>

<body>
  <!-- âœ… ë„¤ë¹„ ìë™ ë¡œë“œ ìë¦¬ -->
  <div id="nav"></div>

  <main class="page">
    <div class="wrap">
      <div class="topbar">
        <div class="title">
          <span>ë©§ë´‰ì´ í”¼í•˜ê¸°</span>
          <span class="pill">â† â†’ / ëª¨ë°”ì¼ ë“œë˜ê·¸</span>
        </div>
        <div class="pill" id="bestPill">BEST: 0</div>
      </div>

      <div class="board" id="board">
        <canvas id="c" width="720" height="1280" aria-label="ë©§ë´‰ì´ í”¼í•˜ê¸° ê²Œì„ ìº”ë²„ìŠ¤"></canvas>

        <div class="hud">
          <div class="box">
            <div class="k">ì ìˆ˜</div>
            <div class="v" id="score">0</div>
          </div>
          <div class="box" style="text-align:right;">
            <div class="k">ë ˆë²¨</div>
            <div class="v" id="level">1</div>
          </div>
        </div>

        <div class="overlay" id="overlay">
          <div class="modal">
            <div style="font-size:42px; line-height:1;">ğŸ«£</div>
            <h2 id="modalTitle">ë©§ë´‰ì´ í”¼í•˜ê¸°</h2>
            <p id="modalDesc">
              ë°”ë‹¥ì˜ ì—¬ë´‰ì´ë¥¼ ì¢Œìš°ë¡œ ì›€ì§ì—¬<br/>
              ìœ„ì—ì„œ ë–¨ì–´ì§€ëŠ” ë©§ë´‰ì´ ì–¼êµ´ì„ í”¼í•˜ì„¸ìš”!
            </p>
            <div class="btns">
              <button class="primary" id="startBtn">ì‹œì‘í•˜ê¸°</button>
              <button id="howBtn">ì¡°ì‘ë°©ë²•</button>
            </div>
            <div class="hint" id="hintText">
              ëª¨ë°”ì¼: ìºë¦­í„°ë¥¼ í„°ì¹˜í•œ ì±„ ì¢Œìš°ë¡œ ë“œë˜ê·¸<br/>
              PC: â† â†’ ë˜ëŠ” A/D
            </div>
          </div>
        </div>
      </div>

      <div class="footerhint">
        PNG ì¤€ë¹„ë˜ë©´ ìë™ìœ¼ë¡œ ìºë¦­í„°ê°€ ì´ë¯¸ì§€ë¡œ ë Œë”ë§ë¼ìš” (ë¯¸ì¤€ë¹„ ì‹œ ì„ì‹œ ì´ëª¨ì§€ë¡œ í‘œì‹œ)
      </div>
    </div>
  </main>

  <!-- âœ… í‘¸í„° ìë™ ë¡œë“œ ìë¦¬ -->
  <div id="footer"></div>

<script>
(() => {
  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");

  const board = document.getElementById("board");
  const overlay = document.getElementById("overlay");
  const startBtn = document.getElementById("startBtn");
  const howBtn = document.getElementById("howBtn");
  const scoreEl = document.getElementById("score");
  const levelEl = document.getElementById("level");
  const bestPill = document.getElementById("bestPill");
  const modalTitle = document.getElementById("modalTitle");
  const modalDesc  = document.getElementById("modalDesc");

  // âœ… ì´ë¯¸ì§€ ê²½ë¡œ(ê³ ì •)
const IMG_PLAYER = "img/yeobong.png";
const IMG_ENEMY  = "img/metbong.png";

  // ====== í™”ë©´ í¬ê¸°(ë°˜ì‘í˜•) â†’ ë‚´ë¶€ ë…¼ë¦¬ í¬ê¸° ìœ ì§€ ======
  const W = canvas.width;
  const H = canvas.height;

  // ====== ë¡œì»¬ ë² ìŠ¤íŠ¸ ì ìˆ˜ ======
  const BEST_KEY = "metbong_dodge_best";
  let bestScore = Number(localStorage.getItem(BEST_KEY) || 0);
  bestPill.textContent = `BEST: ${bestScore}`;

  // ====== ê²Œì„ ìƒíƒœ ======
  let running = false;
  let gameOver = false;
  let tPrev = 0;

  // í”Œë ˆì´ì–´ (ì—¬ë´‰ì´)
  const player = {
    w: 130,
    h: 130,
    x: W/2,
    y: H - 170,
    speed: 780,
    vx: 0
  };

  // ì¥ì• ë¬¼ (ë©§ë´‰ì´ ì–¼êµ´)
  const enemies = [];
  let spawnTimer = 0;
  let spawnEvery = 0.85;
  let fallSpeed = 520;

  // ì ìˆ˜/ë ˆë²¨
  let score = 0;
  let level = 1;

  // ì…ë ¥
  const keys = { left:false, right:false };

  function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

  // ====== ì´ë¯¸ì§€ ë¡œë“œ(ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ì´ëª¨ì§€ ëª¨ë“œ) ======
  const imgPlayer = new Image();
  const imgEnemy  = new Image();
  let playerImgReady = false;
  let enemyImgReady = false;

  imgPlayer.onload = () => { playerImgReady = true; };
  imgEnemy.onload  = () => { enemyImgReady = true; };

  // ì—ëŸ¬ë‚˜ë„ ê²Œì„ì€ ëŒì•„ê°€ì•¼ í•¨(ê·¸ëƒ¥ ì´ëª¨ì§€ë¡œ ê·¸ë¦¬ê¸°)
  imgPlayer.onerror = () => { playerImgReady = false; };
  imgEnemy.onerror  = () => { enemyImgReady = false; };

  imgPlayer.src = IMG_PLAYER;
  imgEnemy.src  = IMG_ENEMY;

  function resetGame(){
    enemies.length = 0;
    spawnTimer = 0;
    spawnEvery = 0.85;
    fallSpeed = 520;
    score = 0;
    level = 1;
    scoreEl.textContent = "0";
    levelEl.textContent = "1";
    player.x = W/2;
    player.vx = 0;
    gameOver = false;
  }

  function showOverlay(title, desc, startText="ì‹œì‘í•˜ê¸°"){
    modalTitle.textContent = title;
    modalDesc.innerHTML = desc;
    startBtn.textContent = startText;
    overlay.style.display = "flex";
  }
  function hideOverlay(){
    overlay.style.display = "none";
  }

  // ====== ìŠ¤í°/ë‚œì´ë„ ======
  function updateDifficulty(){
    const newLevel = 1 + Math.floor(score / 200);
    if (newLevel !== level){
      level = newLevel;
      levelEl.textContent = String(level);
      spawnEvery = Math.max(0.35, 0.85 - (level-1)*0.06);
      fallSpeed  = Math.min(1200, 520 + (level-1)*55);
    }
  }

  function spawnEnemy(){
    const size = 110 + Math.random()*30;
    const x = 60 + Math.random()*(W - 120);
    enemies.push({
      x, y: -size,
      w: size, h: size,
      vy: fallSpeed * (0.92 + Math.random()*0.22),
      rot: (Math.random()*0.6 - 0.3),
      t: 0
    });
  }

  // ====== ì¶©ëŒ(AABB) ======
  function hit(a, b){
    return (
      a.x - a.w/2 < b.x + b.w/2 &&
      a.x + a.w/2 > b.x - b.w/2 &&
      a.y - a.h/2 < b.y + b.h/2 &&
      a.y + a.h/2 > b.y - b.h/2
    );
  }

  // ====== ê·¸ë¦¬ê¸° ======
  function drawBackground(){
    // ìº”ë²„ìŠ¤ ë°°ê²½ì€ íˆ¬ëª…ìœ¼ë¡œ ë‘ê³ (= boardì˜ bg.pngê°€ ë³´ì´ê²Œ)
    // ê²Œì„ ì˜¤ë¸Œì íŠ¸ë§Œ ê·¸ë¦°ë‹¤.
    ctx.clearRect(0,0,W,H);
  }

  function drawPlayer(){
    const x = player.x, y = player.y;
    ctx.save();

    // ê·¸ë¦¼ì
    ctx.globalAlpha = 0.22;
    ctx.beginPath();
    ctx.ellipse(x, y + player.h/2 - 10, 62, 18, 0, 0, Math.PI*2);
    ctx.fill();
    ctx.globalAlpha = 1;

    if (playerImgReady){
      ctx.drawImage(imgPlayer, x - player.w/2, y - player.h/2, player.w, player.h);
    } else {
      // ì„ì‹œ ì´ëª¨ì§€(ì´ë¯¸ì§€ ì—†ì„ ë•Œ)
      roundRect(x-player.w/2, y-player.h/2, player.w, player.h, 28);
      ctx.fillStyle = "rgba(255,255,255,0.12)";
      ctx.fill();
      ctx.strokeStyle = "rgba(255,255,255,0.18)";
      ctx.lineWidth = 2;
      ctx.stroke();

      ctx.font = "86px system-ui, Apple Color Emoji, Segoe UI Emoji";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("ğŸ™‚", x, y+6);
    }

    ctx.restore();
  }

  function drawEnemy(e){
    ctx.save();
    e.t += 0.016;

    const wobble = Math.sin(e.t*6) * 6;
    ctx.translate(e.x, e.y);
    ctx.rotate(e.rot);

    if (enemyImgReady){
      ctx.drawImage(imgEnemy, -e.w/2, -e.h/2, e.w, e.h);
    } else {
      // ì„ì‹œ ì´ëª¨ì§€(ì´ë¯¸ì§€ ì—†ì„ ë•Œ)
      roundRect(-e.w/2, -e.h/2, e.w, e.h, 30);
      ctx.fillStyle = "rgba(255,77,109,0.18)";
      ctx.fill();
      ctx.strokeStyle = "rgba(255,77,109,0.35)";
      ctx.lineWidth = 2;
      ctx.stroke();

      ctx.font = "84px system-ui, Apple Color Emoji, Segoe UI Emoji";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("ğŸ˜ˆ", wobble*0.1, 8);
    }

    ctx.restore();
  }

  function roundRect(x,y,w,h,r){
    const rr = Math.min(r, w/2, h/2);
    ctx.beginPath();
    ctx.moveTo(x+rr, y);
    ctx.arcTo(x+w, y, x+w, y+h, rr);
    ctx.arcTo(x+w, y+h, x, y+h, rr);
    ctx.arcTo(x, y+h, x, y, rr);
    ctx.arcTo(x, y, x+w, y, rr);
    ctx.closePath();
  }

  // ====== ë£¨í”„ ======
  function loop(ts){
    if(!running) return;
    const t = ts/1000;
    const dt = Math.min(0.033, t - tPrev || 0.016);
    tPrev = t;

    const dir = (keys.left ? -1 : 0) + (keys.right ? 1 : 0);
    player.vx = dir * player.speed;

    player.x += player.vx * dt;
    player.x = clamp(player.x, player.w/2 + 10, W - player.w/2 - 10);

    spawnTimer += dt;
    if(spawnTimer >= spawnEvery){
      spawnTimer = 0;
      spawnEnemy();
    }

    for(let i=enemies.length-1; i>=0; i--){
      const e = enemies[i];
      e.y += e.vy * dt;

      if(e.y - e.h/2 > H + 40){
        enemies.splice(i,1);
        score += 10;
        scoreEl.textContent = String(score);
        updateDifficulty();
        continue;
      }

      const a = { x: player.x, y: player.y, w: player.w*0.78, h: player.h*0.78 };
      const b = { x: e.x, y: e.y, w: e.w*0.78, h: e.h*0.78 };
      if(hit(a,b)){
        endGame();
        return;
      }
    }

    drawBackground();
    drawPlayer();
    enemies.forEach(drawEnemy);

    requestAnimationFrame(loop);
  }

  function endGame(){
    running = false;
    gameOver = true;

    if(score > bestScore){
      bestScore = score;
      localStorage.setItem(BEST_KEY, String(bestScore));
      bestPill.textContent = `BEST: ${bestScore}`;
    }

    showOverlay(
      "ê²Œì„ ì˜¤ë²„!",
      `ì ìˆ˜ <b style="color:var(--ok);">${score}</b> / BEST <b>${bestScore}</b><br/><br/>ë‹¤ì‹œ ë„ì „í• ê¹Œìš”?`,
      "ë‹¤ì‹œí•˜ê¸°"
    );
  }

  function startGame(){
    resetGame();
    hideOverlay();
    running = true;
    tPrev = 0;
    requestAnimationFrame(loop);
  }

  // ====== í‚¤ë³´ë“œ ì…ë ¥ ======
  window.addEventListener("keydown", (e) => {
    if(e.key === "ArrowLeft" || e.key.toLowerCase() === "a") keys.left = true;
    if(e.key === "ArrowRight"|| e.key.toLowerCase() === "d") keys.right = true;
    if(e.key === " " && !running) startGame();
  });
  window.addEventListener("keyup", (e) => {
    if(e.key === "ArrowLeft" || e.key.toLowerCase() === "a") keys.left = false;
    if(e.key === "ArrowRight"|| e.key.toLowerCase() === "d") keys.right = false;
  });

  // ====== ëª¨ë°”ì¼/í„°ì¹˜ ë“œë˜ê·¸ ======
  let dragging = false;
  function getPos(ev){
    const rect = canvas.getBoundingClientRect();
    const p = ev;
    const sx = (p.clientX - rect.left) / rect.width;
    const sy = (p.clientY - rect.top) / rect.height;
    return { x: sx*W, y: sy*H };
  }

  board.addEventListener("pointerdown", (ev) => {
    if(overlay.style.display !== "none") return;
    const p = getPos(ev);
    if(Math.abs(p.x - player.x) < player.w && Math.abs(p.y - player.y) < player.h){
      dragging = true;
      board.setPointerCapture(ev.pointerId);
    }
  });
  board.addEventListener("pointermove", (ev) => {
    if(!dragging || !running) return;
    const p = getPos(ev);
    player.x = clamp(p.x, player.w/2 + 10, W - player.w/2 - 10);
  });
  board.addEventListener("pointerup", (ev) => {
    dragging = false;
    try{ board.releasePointerCapture(ev.pointerId); }catch(_){}
  });

  // ====== ë²„íŠ¼ ======
  startBtn.addEventListener("click", () => startGame());
  howBtn.addEventListener("click", () => {
    showOverlay(
      "ì¡°ì‘ë°©ë²•",
      `PC: <b>â† â†’</b> ë˜ëŠ” <b>A / D</b><br/>ëª¨ë°”ì¼: ì—¬ë´‰ì´ë¥¼ <b>í„°ì¹˜í•œ ì±„ ì¢Œìš° ë“œë˜ê·¸</b><br/><br/>ë©§ë´‰ì´ ì–¼êµ´ì— ë‹¿ìœ¼ë©´ ê²Œì„ ì˜¤ë²„!`,
      gameOver ? "ë‹¤ì‹œí•˜ê¸°" : "ì‹œì‘í•˜ê¸°"
    );
  });

  // ì²« í™”ë©´
  showOverlay(
    "ë©§ë´‰ì´ í”¼í•˜ê¸°",
    "ë°”ë‹¥ì˜ ì—¬ë´‰ì´ë¥¼ ì¢Œìš°ë¡œ ì›€ì§ì—¬<br/>ìœ„ì—ì„œ ë–¨ì–´ì§€ëŠ” ë©§ë´‰ì´ ì–¼êµ´ì„ í”¼í•˜ì„¸ìš”!",
    "ì‹œì‘í•˜ê¸°"
  );

  // âœ… ì—¬ê¸°ì„œ nav/footer ìë™ ë¡œë“œ (common.jsì˜ loadHTML í•¨ìˆ˜ ì‚¬ìš©)
  window.addEventListener("DOMContentLoaded", async () => {
    try{
      await loadHTML("#nav", "/common/nav.html");
      await loadHTML("#footer", "/common/footer.html");
      if (typeof setActiveNav === "function") setActiveNav();
    }catch(e){
      // nav/footer ë¡œë“œ ì‹¤íŒ¨í•´ë„ ê²Œì„ì€ ì‹¤í–‰ë˜ê²Œ ë‘ 
      console.log("nav/footer load failed:", e);
    }
  });

})();
</script>
</body>
</html>
